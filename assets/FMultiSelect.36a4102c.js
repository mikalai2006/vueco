var ve=Object.defineProperty;var O=(t,v)=>ve(t,"name",{value:v,configurable:!0});import{d as $,a as g,v as pe,b as x,l as ae,n as N,h as G,x as X,F as W,p as me,t as he,q as H,o as w,y as T,f as A,j as F,z as ee,w as C,m as ye,u as k,A as be,B as j,E as le,e as I,C as K,D,k as J,i as ge}from"./vue.esm-bundler.63e44d6a.js";import{u as te}from"./useId.06feead9.js";import"./browser.cfbb4fdd.js";import{i as ke,a as oe,c as we}from"./useIcon.fe9488f3.js";import{L as Oe}from"./LSpinner.d97669ba.js";import{L as Y}from"./LIcon.a931258d.js";import{r as xe}from"./ripple.4234d591.js";const R=Symbol("SelectContext"),Se=$({name:"LMultiSelect",props:{modelValue:{type:[Array,String,Number],default:()=>[]},showField:{type:Boolean,default:!1},field:{type:Object,required:!0,default:()=>({})}},emits:["update:showList","update:modelValue","onLoadItems","on-input","on-choose","on-choose-group"],setup(t,{emit:v,slots:e,expose:d}){const c=O(s=>{var m,a,h;const u=s.target;!((m=l.selectButtonEl.value)!=null&&m.contains(u))&&!((a=l.listBoxEl.value)!=null&&a.contains(u))&&!((h=l.searchEl.value)!=null&&h.contains(u))&&(L.value=!1,f())},"close"),f=O(()=>{document.removeEventListener("click",c),document.removeEventListener("keyup",c)},"unRegisterOverlay"),n=O(()=>{document.addEventListener("click",c),document.addEventListener("keyup",c)},"registerOverlay"),p=g(null),y=g([]),r=g(null),o=g(null),i=g(t.field),b=g(0),U=g(0),q=g(!1),V=g(""),L=g(!1),z=g(!1),M=g(!1),Q=g(""),B=g(0);pe(()=>L.value,s=>{v("update:showList",s)});const S=i.value.keyGroup||void 0,P=x({get(){return t.field.multiple&&Array.isArray(t.modelValue)?[...t.modelValue]:t.modelValue?[t.modelValue]:[]},set(s){const u=i.value.multiple?s:s[0];v("update:modelValue",u),v("on-input",u)}}),Z=x(()=>{const s=i.value.items||[];let u=s;const m=i.value.keyFilter;return m&&(u=s.filter(a=>typeof a=="object"?a[m].toLowerCase().indexOf(Q.value.toLowerCase())!==-1:typeof a=="number"?a!==-1:a.toLowerCase().indexOf(Q.value.toLowerCase())!==-1).sort((a,h)=>l.model.value.indexOf(a[m])-l.model.value.indexOf(h[m]))),u}),_=x(()=>{const s=i.value.items||[],u=i.value.keyValue;let m=[];return m=s.filter(a=>l.model.value.includes(typeof a=="object"&&u?a[u]:a)).sort((a,h)=>l.model.value.indexOf(a[u])-l.model.value.indexOf(h[u])),m}),ue=x(()=>{var u,m;const s={};return S||(s.default={selected:_.value.length||0,length:((u=i.value.items)==null?void 0:u.length)||0,key:"default"}),S&&((m=Z.value.sort((a,h)=>typeof a[S]=="string"?a[S].localeCompare(h[S]):a-h))==null||m.forEach(a=>{let h=typeof a[S]=="string"?a[S]:a[S].toString();typeof a=="object"&&(s[h]={selected:_.value.filter(E=>typeof E=="object"&&E[S]==h).length,length:s[h]?s[h].length+1:1,key:h})})),s});d({elselect:r});const ne=O(({range:s})=>{if(!i.value.multiple)return;const{from:u,to:m}=s;if(!i.value.items)return;const a=i.value.items.slice(u<m?u:m,m>u?m+1:u+1);l.model.value=JSON.parse(JSON.stringify(a.map(h=>i.value.keyValue&&typeof h=="object"?h[i.value.keyValue]:h)))},"chooseItemsOfRange"),ie=O(s=>{const u=l!=null&&l.field.value.keyValue?s[l.field.value.keyValue]:s,m=l.model.value.findIndex(h=>h===u);let a=[...l.model.value];l.field.value.multiple?m!==-1?a.splice(m,1):a.push(u):a=[u],v("on-choose",s),l.model.value=a},"onChooseOption"),se=O(s=>{if(console.time("chooseGroup"),!(l!=null&&l.field.value.multiple))return;const{length:u,selected:m}=s,a=l.field.value.items.filter(E=>l.groupkey?E[l.groupkey]===s.key:!0).map(E=>l.field.value.keyValue?E[l.field.value.keyValue]:E);v("on-choose-group",a);const h=u!==m?l.model.value.concat(a):l.model.value.filter(E=>a.indexOf(E)<0);l.model.value=h,console.timeEnd("chooseGroup")},"onChooseGroup"),re=O(s=>{let u=l.focusOption.value||0;return l.focusOption.value==-1&&(u=0),s.key==="ArrowDown"?u++:s.key==="ArrowUp"&&u--,u>l.optionsEl.value.length-1&&(u=l.optionsEl.value.length-1),u<0&&(u=0),u},"onChangeActiveIndex"),de=O(()=>{l.focusOption.value||(l.focusOption.value=0);const s=l.field.value.multiple?l.model.value[0]:l.model.value,u=l.field.value.keyValue,m=l.filteredOptions.value.findIndex(a=>u&&typeof a=="object"?a[u]==s:a==s);m&&m!=-1&&(l.focusOption.value=m),N(()=>{var E;const a=l.filteredOptions.value[l.focusOption.value],h=l.optionsEl.value.find(fe=>fe.key===(u?a[u]:a));h.el&&((E=h.el)==null||E.focus())})},"onSetFocus"),l={id:t.field.name,selectButtonEl:r,listBoxEl:o,searchEl:p,optionsEl:y,focusOption:B,model:P,field:i,show:L,loading:M,disabled:z,groups:ue,groupkey:S,selectedOptions:_,filteredOptions:Z,filterText:Q,searchQuery:V,clearSearchQuery(){V.value!==""&&(V.value="")},pressShift:q,indexShiftFrom:b,indexShiftTo:U,registerOverlay:n,unRegisterOverlay:f,chooseItemsOfRange:ne,onLoadItems:()=>v("onLoadItems"),updateModel:s=>{v("update:modelValue",s),v("on-input",s)},onChangeActiveIndex:re,onChooseOption:ie,onChooseGroup:se,onSetFocus:de};he(R,l);const ce=O(async()=>{M.value=!0,z.value=!0,await v("onLoadItems"),M.value=!1,z.value=!1},"loadData");return ae(async()=>{await ce(),i.value.autofocus&&N(()=>{var s;l.searchEl.value?l.searchEl.value.focus():(s=r.value)==null||s.focus()})}),()=>G("div",{},{default:()=>e.default?e.default({select:l,loading:M.value,disabled:z.value,show:l.show.value,filteredOptions:Z.value,focusOption:l.focusOption.value,indexShiftFrom:l.indexShiftFrom.value,indexShiftTo:l.indexShiftTo.value,selectedOptions:l.selectedOptions.value||[]}):[]})}}),Ve=$({name:"LMultiSelectButton",setup(t,{slots:v}){const e=H(R);if(!e){console.info("%s must be use inner %s component!","LMultiSelectButton","LMultiSelect");return}const d=x(()=>{const f={};return e.show.value&&(f["aria-controls"]=`${e.field.value.name}-listbox`),f}),c=x(()=>e.searchEl.value?{}:{role:"button",type:"button",tabindex:0,disabled:e.disabled.value,"aria-expanded":e.show.value,"aria-haspopup":"listbox","aria-labelledby":e.field.value.label?`${e.field.value.name}_label`:void 0,...d.value});return()=>G(e.searchEl.value?"div":"button",{ref:e.selectButtonEl,id:`${e.id}-button`,...c.value,onClick:X(()=>{e.show.value=!e.show.value,e.show.value?(N(()=>{e.onSetFocus()}),e.searchEl.value&&N(()=>{var f;(f=e.searchEl.value)==null||f.focus()}),setTimeout(()=>{e.registerOverlay()},50)):e.unRegisterOverlay()},[]),onKeydown:X(f=>{switch(f.key){case"Enter":e.onChooseOption(e.filteredOptions.value[e.focusOption.value]),e.field.value.multiple||N(()=>{var n,p;e.searchEl.value?(n=e.searchEl.value)==null||n.focus():(p=e.selectButtonEl.value)==null||p.focus({preventScroll:!0}),e.show.value=!1});break;case"ArrowUp":case"ArrowDown":e.show.value||(e.show.value=!0,e.registerOverlay()),e.show.value&&e.onChangeActiveIndex(f),N(()=>{e.onSetFocus()});break;case"Escape":e.show.value=!1,e.focusOption.value=0,e.unRegisterOverlay();break}},[])},v.default?v.default({show:e.show.value,disabled:e.disabled.value,loading:e.loading.value}):[])}}),Ee=$({name:"LMultiSelectList",setup(t,{emit:v,slots:e}){const d=H(R),c=O(n=>{const p=d.model.value.findIndex(y=>y==(n[d.field.value.keyValue]||n));if(p!==-1){const y=[...d.model.value];y.splice(p,1),d.model.value=y}},"removeOption"),f=O(()=>{d.model.value.splice(d.model.value.length-1,1)},"removeLast");return()=>G(W,{},e.default?e.default({removeOption:c,onKeydown:n=>{n.key==="Backspace"&&f()}}):[])}}),Le=$({name:"LMultiSelectSearch",setup(t,{slots:v}){const e=H(R,{}),d=g(""),c=g(null),f=O(()=>{e.filterText.value=d.value,e.loading.value=!1,e.show.value||(e.show.value=!0,setTimeout(()=>{e.registerOverlay()},50))},"onSearch");return()=>{var n;return G("input",{ref:p=>e.searchEl.value=p,role:"combobox",tabindex:0,placeholder:(n=e.field.value)==null?void 0:n.placeholder,disabled:e.disabled.value,"aria-expanded":e.show.value,"aria-haspopup":"listbox","aria-labelledby":e.field.value.label?`${e.field.value.name}_label`:void 0,"aria-controls":e.show.value?`${e.field.value.name}-listbox`:void 0,value:d.value,onInput:p=>{const y=p.target;c.value&&clearTimeout(c.value),e.loading.value=!0,c.value=setTimeout(()=>f(),350),d.value=y.value}})}}}),Fe=$({name:"LMultiSelectOptions",setup(t,{slots:v}){const e=H(R);if(!e)return;te();const d=x(()=>{const n={};return e.focusOption.value!=null&&e.focusOption.value!==-1&&(n["aria-activedescendant"]=`${e.id}-option-${e.focusOption.value}`),e.field.value.multiple&&(n["aria-multiselectable"]=!0),n}),c=O(()=>{var p,y;if(!e.field.value.multiple)return;const n=e.field.value.keyValue;if(e.model.value.length===((p=e.field.value.items)==null?void 0:p.length))e.model.value=[];else{const r=(y=e.field.value.items)==null?void 0:y.map(o=>n&&typeof o=="object"?o[n]:o);r&&(e.model.value=r)}},"toggleChooseAll"),f=g(null);return()=>G("div",{ref:e.listBoxEl,id:`${e.field.value.name}-listbox`,role:"listbox","aria-labelledby":`${e.field.value.name}_label`,tabindex:0,...d.value,onKeydown:X(n=>{var y,r,o;if(f.value&&clearTimeout(f.value),f.value=setTimeout(()=>e.clearSearchQuery(),350),n.ctrlKey&&n.key==="a"&&(c(),n.preventDefault()),n.key==="Escape"){e.focusOption.value=0,e.show.value=!1,e.searchEl.value?(y=e.searchEl.value)==null||y.focus():(r=e.selectButtonEl.value)==null||r.focus({preventScroll:!0});return}const p=e.onChangeActiveIndex(n);if(n.preventDefault(),p!==e.focusOption.value){e.focusOption.value=p;const i=e.field.value.keyValue,b=e.filteredOptions.value[p],U=e.optionsEl.value.find(q=>{let V=b;return typeof b=="object"&&i&&(V=b[i]),q.key==V});U&&((o=U.el)==null||o.focus())}n.shiftKey||(e.indexShiftFrom.value=p),n.shiftKey&&(n.key==="ArrowDown"||n.key==="ArrowUp")&&(e.indexShiftTo.value=e.focusOption.value,e.chooseItemsOfRange({range:{from:e.indexShiftFrom.value,to:e.indexShiftTo.value}}))},["stop"]),onKeyup:n=>{n.key==="Shift"&&(e.pressShift.value=!1,e.indexShiftFrom.value=0,e.indexShiftTo.value=0)},onFocus:()=>{}},v.default?v.default({groups:e==null?void 0:e.groups.value,options:e==null?void 0:e.filteredOptions.value}):[])}}),Ce=$({name:"LMultiSelectGroup",props:{group:{type:[String,Number],default:"default",required:!0}},setup(t,{slots:v,emit:e}){const d=H(R);if(!d)return;const c=te(),f=x(()=>d.groups.value[t.group]),n=x(()=>{const y=d.field.value.keyFilter?d.filteredOptions.value:d.field.value.items;return d.groupkey?y.filter(r=>r[d.groupkey]===t.group):y}),p=x(()=>f.value.selected===f.value.length);return()=>G("div",{id:`${d==null?void 0:d.id}-group-${c}`,role:"group","aria-disabled":!1,onClick:X(()=>{d.onChooseGroup(f.value)},["stop"])},v.default?v.default({groupId:c,options:n.value,groupSelectedOption:f.value.selected,groupLength:f.value.length,groupSelect:p.value}):[])}}),Ie=$({name:"LMultiSelectOption",props:{value:{type:[String,Number,Object],default:""}},setup(t,{slots:v}){const e=H(R),d=g(null),c=x(()=>e.field.value.keyValue?t.value[e.field.value.keyValue]:t.value);ae(()=>{e.optionsEl.value.push({key:c.value,el:d.value})});const f=te(),n=x(()=>e.optionsEl.value.findIndex(r=>r.key==c.value));me(()=>{e==null||e.optionsEl.value.splice(n.value,1)});const p=x(()=>e.model.value.includes(e.field.value.keyValue?t.value[e.field.value.keyValue]:t.value)),y=x(()=>{const r=e.field.value.keyValue,o=e.filteredOptions.value[e.focusOption.value];let i=!1;return o&&(i=(r?t.value[r]:t.value)==(r?o[r]:o)),i});return()=>G("div",{ref:d,id:`${e.id}-option-${f}`,role:"option","aria-disabled":!1,tabindex:-1,"aria-selected":p.value===!0?p.value:void 0,onFocus:()=>{},onKeydown:r=>{var o,i;r.key==="Enter"&&(e.onChooseOption(t.value),e.field.value.multiple||(e.show.value=!1,e.searchEl.value?(o=e.searchEl.value)==null||o.focus():(i=e.selectButtonEl.value)==null||i.focus({preventScroll:!0}),r.preventDefault()))},onMouseenter:r=>{e.focusOption.value=n.value,r.shiftKey?e.indexShiftTo.value=e.focusOption.value-1:e.indexShiftFrom.value=e.focusOption.value},onMouseleave:r=>{e.focusOption.value=null,r.shiftKey||(e.indexShiftFrom.value=0)},onClick:X(r=>{r.shiftKey?e.chooseItemsOfRange({range:{from:e.indexShiftFrom.value,to:e.indexShiftTo.value}}):(e==null||e.onChooseOption(t.value),e.field.value.multiple||(e.selectButtonEl.value.focus({preventScroll:!0}),e.show.value=!1,r.preventDefault()),N(()=>{var o;e!=null&&e.searchEl.value&&((o=e==null?void 0:e.searchEl.value)==null||o.focus(),r.preventDefault())}))},["stop"])},v.default?v.default({optionId:f,selected:p.value,hovered:y.value,focused:e==null?void 0:e.focusOption.value}):[])}}),$e={class:"flex-auto flex flex-wrap m-1"},Me={class:"m-0.5 rounded-md py-1 leading-5 bg-s-200 dark:bg-s-600 flex items-center"},Be={class:"block flex-auto px-1"},Te={key:1,class:"p-1 text-s-500 dark:text-s-400"},Ae={class:"py-2 pr-2"},De={class:"absolute right-8 top-0 h-full flex items-center"},je={key:0,class:"p-2"},qe={class:"shadow-inner max-h-64 b-scroll overflow-y-auto"},Ke={key:0,class:"flex p-2 font-bold cursor-pointer bg-s-100 dark:bg-s-900"},Ne={class:j(["flex items-center border rounded-md h-6 w-6 mr-2 border-s-200 dark:border-s-700 text-xl text-p-500"])},Ge=$({name:"FMultiSelect",inheritAttrs:!1}),Re=$({...Ge,props:{modelValue:null,error:null,field:null,required:{type:Boolean}},emits:["update:modelValue","on-input","on-load-items","on-choose","on-choose-group"],setup(t,{emit:v}){const e=t,d=xe,c=x({get(){return e.modelValue},set(o){v("update:modelValue",o)}}),f=x(()=>{let o=!0;switch(typeof c.value){case"string":o=c.value=="";break;case"number":o=c.value==0;break;default:Array.isArray(c.value)&&(o=c.value.length==0);break}return o}),n=g(null),p=O(()=>{var i;const o=(i=n.value)==null?void 0:i.$el;o&&o.click()},"onSetFocus"),y=O(async()=>{let o=0;switch(typeof c.value){case"string":o="";break;default:o=[];break}c.value=o,await v("on-input"),await p()},"onReset"),r=g(!1);return(o,i)=>(w(),T(W,null,[A(o.$slots,"label",{id:t.field.id,required:t.required,onSetFocus:p}),F("div",{class:j(["flex items-center",["rounded-md border text-base transition w-full appearance-none outline-none focus-within:ring-1 hover:ring-1  bg-white dark:bg-s-900",{"border-d-500 dark:border-d-500 focus-within:ring-d-500 focus-within:border-d-500 hover:ring-d-500":t.error},(r.value,""),{"border-s-200 dark:border-s-600 focus-within:ring-p-500 focus-within:border-p-500  hover:ring-p-500 hover:border-p-500":!t.error}]])},[A(o.$slots,"before"),ee(k(Se),ye(o.$attrs,{modelValue:k(c),"onUpdate:modelValue":i[0]||(i[0]=b=>be(c)?c.value=b:null),showList:r.value,"onUpdate:showList":i[1]||(i[1]=b=>r.value=b),field:t.field,error:t.error,class:"relative flex-auto",onOnLoadItems:i[2]||(i[2]=b=>o.$emit("on-load-items",b)),onOnInput:i[3]||(i[3]=b=>o.$emit("on-input",b)),onOnChoose:i[4]||(i[4]=b=>o.$emit("on-choose",b)),onOnChooseGroup:i[5]||(i[5]=b=>o.$emit("on-choose-group",b))}),{default:C(({show:b,loading:U,selectedOptions:q})=>[ee(k(Ve),{ref_key:"inputElement",ref:n,class:j(["outline-none flex space-x-2 items-center w-full transition"])},{default:C(()=>[F("div",$e,[(w(!0),T(W,null,le(q,V=>(w(),I(k(Ee),{key:V.name},{default:C(({removeOption:L})=>[A(o.$slots,"selected-item",{option:V,removeOption:L},()=>[F("div",Me,[F("span",Be,D(t.field.keyLabel?V[t.field.keyLabel]:V),1)])])]),_:2},1024))),128)),t.field.keyFilter&&(!q.length&&!t.field.multiple||t.field.multiple)?(w(),I(k(Le),{key:0,class:"px-2 py-1 cursor-text outline-none bg-transparent placeholder-s-400"})):K("",!0),!t.field.keyFilter&&!q.length?(w(),T("div",Te,D(t.field.placeholder),1)):K("",!0)]),F("div",Ae,[U?(w(),I(k(Oe),{key:0})):(w(),I(k(Y),{key:1,class:j(["transition-transform",{"rotate-180":b}])},{default:C(()=>[J(D(k(ke)),1)]),_:2},1032,["class"]))])]),_:2},1536),F("div",De,[A(o.$slots,"after",{onReset:y,empty:k(f)})]),F("div",{class:j(["z-10 mt-1.5 transition shadow-2xl outline-none border border-s-200 dark:border-s-700 rounded-md absolute top-full left-0 right-0 bg-white dark:bg-s-800",[b?"block":"hidden",(t.error,""),{"border-d-500 dark:border-d-500 focus-within:ring-d-500 focus-within:border-d-500":t.error},(r.value,""),{"border-s-200 dark:border-s-600 focus-within:ring-p-500 focus-within:border-p-500":!t.error}]])},[t.error?(w(),T("div",je,[A(o.$slots,"error",{error:t.error})])):K("",!0),F("div",qe,[ee(k(Fe),null,{default:C(({groups:V})=>[(w(!0),T(W,null,le(V,L=>(w(),I(k(Ce),{key:L.key,group:L.key},{default:C(({options:z,groupSelectedOption:M,groupLength:Q})=>[L.key!=="default"?(w(),T("div",Ke,[F("div",Ne,[M==Q?(w(),I(k(Y),{key:0},{default:C(()=>[J(D(k(oe)),1)]),_:1})):K("",!0),M<Q&&M!=0?(w(),I(k(Y),{key:1},{default:C(()=>[J(D(k(we)),1)]),_:1})):K("",!0)]),J(" "+D(L.key),1)])):K("",!0),(w(!0),T(W,null,le(z,B=>(w(),I(k(Ie),{key:t.field.keyValue?B[t.field.keyValue]:B,value:B,class:"group relative overflow-hidden focus:outline-none cursor-pointer"},{default:C(({selected:S,hovered:P})=>[A(o.$slots,"option",{option:B,selected:S,hovered:P},()=>[ge((w(),T("div",{class:j(["flex p-2 items-center cursor-pointer focus:outline-none",P?"bg-p-200 dark:bg-p-800 text-black dark:text-white group-focus:bg-p-200 group-hover:bg-p-200 dark:group-hover:bg-p-800 dark:group-focus:bg-p-800":"bg-transparent text-black dark:text-white group-focus:bg-p-100 group-hover:bg-p-100 dark:group-hover:bg-p-900 dark:group-focus:bg-p-900"])},[F("div",{class:j(["flex items-center border rounded-md h-6 w-6 mr-2",S||P?"border-transparent":"border-s-200 dark:border-s-700"])},[S?(w(),I(k(Y),{key:0,class:j(["text-xl",{"text-p-500 dark:text-p-500":S}])},{default:C(()=>[J(D(k(oe)),1)]),_:2},1032,["class"])):K("",!0)],2),J(D(t.field.keyLabel?B[t.field.keyLabel]:B),1)],2)),[[k(d),{}]])])]),_:2},1032,["value"]))),128))]),_:2},1032,["group"]))),128))]),_:3})])],2)]),_:3},16,["modelValue","showList","field","error"])],2),A(o.$slots,"error",{error:t.error}),A(o.$slots,"description")],64))}});Re.__docgenInfo={exportName:"default",displayName:"FMultiSelect",description:"",tags:{},props:[{name:"modelValue",description:"modelValue - model string",required:!0,type:{name:"ISelectModel"}},{name:"error",required:!1,type:{name:"string"}},{name:"field",description:"Schema for field.",required:!0,type:{name:"IField"}},{name:"required",required:!1,type:{name:"boolean"}}],events:[{name:"on-load-items"},{name:"on-input"},{name:"on-choose"},{name:"on-choose-group"},{name:"update:modelValue"}],slots:[{name:"label",scoped:!0,bindings:[{name:"id",title:"binding"},{name:"required",title:"binding"},{name:"onSetFocus",title:"binding"}]},{name:"before"},{name:"selected-item",scoped:!0,bindings:[{name:"option",title:"binding"},{name:"removeOption",title:"binding"}]},{name:"after",scoped:!0,bindings:[{name:"on-reset",title:"binding"},{name:"empty",title:"binding"}]},{name:"error",scoped:!0,bindings:[{name:"error",title:"binding"}]},{name:"option",scoped:!0,bindings:[{name:"option",title:"binding"},{name:"selected",title:"binding"},{name:"hovered",title:"binding"}]},{name:"description"}]};export{Re as _};
//# sourceMappingURL=FMultiSelect.36a4102c.js.map
