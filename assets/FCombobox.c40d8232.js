var fe=Object.defineProperty;var O=(o,v)=>fe(o,"name",{value:v,configurable:!0});import{d as E,b as C,a as f,v as ie,l as se,n as V,h as P,x as $,p as ve,t as pe,q as J,o as g,y as I,f as F,j as A,z as Z,w as T,m as me,u as m,A as be,B,C as te,F as G,e as q,D,E as le,k as _,i as ae,G as he}from"./vue.esm-bundler.63e44d6a.js";import{u as Oe}from"./useId.06feead9.js";import{i as ye,a as ge}from"./useIcon.fe9488f3.js";import{L as xe}from"./LSpinner.d97669ba.js";import{L as ne}from"./LIcon.a931258d.js";import{r as ke}from"./ripple.4234d591.js";const we=O(o=>o.length===1&&o.match(/\S| /),"isPrintableCharacter"),H=Symbol("ComboboxContext"),Ce=E({props:{modelValue:{type:[Array,String,Number],default:()=>[]},field:{type:Object,required:!0,default:()=>({})},error:{type:String,default:""},showList:{type:Boolean,default:!1}},emits:["update:showList","update:modelValue","onLoadItems","onInput","onChoose"],setup(o,{slots:v,emit:e}){const y=C(()=>{var n;return((n=o.field)==null?void 0:n.autocomplete)||"none"}),i=f(!1),b=f(!1),l=f(!1),t=f(o.field),L=f(-1),p=C(()=>X.value.length>0),s=f(null),r=f(!1),d=f(!1),x=f(!1),Q=C(()=>{var n;return((n=t.value)==null?void 0:n.disabled)||x.value||!1}),W=f(!1),R=f(!1),S=f(null),N=f(null),j=f([]),U=C({get(){return o.field.multiple&&Array.isArray(o.modelValue)?[...o.modelValue]:[o.modelValue]},set(n){const c=t.value.multiple?n:n[0];e("update:modelValue",c),e("onInput",c)}}),ue=C(()=>(t.value.items||[]).filter(u=>U.value.includes(t.value.keyValue?u[t.value.keyValue]:u))),z=f(""),re=f(""),X=f([]),Y=O(n=>{console.time("onFilterOptions"),typeof n!="boolean"&&(n=!1);const c=z.value.toLowerCase();let u=[];const k=t.value.keyFilter,w=t.value.items||[];return(i.value||z.value.length===0)&&!n?u=w:k?u=w.filter(h=>typeof h=="object"?h[k].toLowerCase().indexOf(c)===0:!1).sort((h,M)=>a.model.value.indexOf(h[k])-a.model.value.indexOf(M[k])):u=w.filter(h=>typeof h=="string"?h.toLowerCase().indexOf(c)===0:""),X.value=u,console.timeEnd("onFilterOptions"),u},"onFilterOptions");if(ie(()=>o.field.items,()=>{Y()}),t.value.autocomplete)if(typeof t.value.autocomplete=="string"){const n=t.value.autocomplete.toLowerCase();i.value=n==="none",b.value=n==="list",l.value=n==="both"}else i.value=!0;const de=O(()=>{r.value=!0,setTimeout(()=>{oe()},10),V(()=>{var n;a.isNone.value||(n=S.value)==null||n.setSelectionRange(0,a.filter.value.length)})},"open"),K=O((n,c)=>{var k,w;if(typeof c!="boolean"&&(c=!1),!n)return;const u=n.target;(c||!((k=a.listboxNode.value)!=null&&k.contains(u))&&a.comboboxNode.value!=u)&&(ee(),r.value=!1,(w=S.value)==null||w.focus(),a.focusOption.value=-1,t.value.multiple||V(()=>{var h;a.isNone.value||(h=S.value)==null||h.setSelectionRange(a.filter.value.length,a.filter.value.length)}))},"close"),ee=O(()=>{document&&(document.removeEventListener("click",K),document.removeEventListener("keyup",K))},"unRegisterOverlay"),oe=O(()=>{document&&(document.addEventListener("click",K),document.addEventListener("keyup",K))},"registerOverlay"),a={autocomplete:y,isNone:i,isBoth:l,isList:b,field:t,comboboxNode:S,listboxNode:N,focusOption:L,hasOptions:p,filter:z,filterText:re,option:s,allOptions:j,filteredOptions:X,model:U,comboboxHasVisualFocus:W,listboxHasVisualFocus:R,hasHover:d,isOpen:r,isBusy:x,isDisabled:Q,open:de,close:K,registerOverlay:oe,unRegisterOverlay:ee,onChangeActiveIndex:O((n,c)=>{let u=a.focusOption.value||0;return c||c===0?u=c:(n.key==="ArrowDown"?u++:n.key==="ArrowUp"&&u--,u>a.allOptions.value.length-1&&(u=a.allOptions.value.length-1),u<0&&(u=0)),a.focusOption.value=u,u},"onChangeActiveIndex"),onSetFocusOption:O(()=>{const n=a.field.value.keyValue;V(()=>{var k;const c=a.filteredOptions.value[a.focusOption.value];if(!c)return;const u=a.allOptions.value.find(w=>w.index===(n&&typeof c=="object"?c[n]:c));u!=null&&u.el&&((k=u.el)==null||k.focus())})},"onSetFocusOption"),onChooseOption:O((n,c)=>{typeof c!="boolean"&&(c=!1);const u=a.field.value.keyValue&&typeof n=="object"?n[a.field.value.keyValue]:n;e("onChoose",u);const k=a.model.value.findIndex(h=>h===u);let w=[...a.model.value];a.field.value.multiple?(k!==-1?w.splice(k,1):w.push(u),a.filter.value=`${u}`):(w=[u],a.filter.value=`${u}`),i.value||V(()=>{var h,M;c?(h=a.comboboxNode.value)==null||h.setSelectionRange(0,a.filter.value.length):(M=a.comboboxNode.value)==null||M.setSelectionRange(a.filterText.value.length,a.filter.value.length)})},"onChooseOption"),onFilterOptions:Y,onSetValue:O(()=>{if(t.value.multiple){const n=[...a.model.value],c=a.model.value.findIndex(u=>u==a.filter.value);c!=-1?n.splice(c,1):n.push(a.filter.value),a.model.value=n,z.value=""}else a.model.value=[a.filter.value];a.onFilterOptions(),console.groupEnd()},"onSetValue")},ce=O(async()=>{x.value=!0,await e("onLoadItems"),x.value=!1},"loadData");return se(async()=>{await ce(),V(()=>{var n;t.value.autofocus&&((n=a.comboboxNode.value)==null||n.focus())}),await Y()}),pe(H,a),()=>P("div",null,{default:()=>v.default?v.default({isNone:i.value,isOpen:r.value,isBusy:x.value,selectedOptions:ue.value}):[]})}}),Ve=E({name:"LComboboxInput",setup(o,{slots:v}){const e=J(H);if(!e){console.info("LComboboxInput must be nested to LCombobox component");return}const y=f(null),i=O(()=>{e.filterText.value=e.filter.value,e.isBusy.value=!1,e.focusOption.value=-1,!e.isOpen.value&&e.open(),e.onFilterOptions(),V(()=>{if(e.isBoth.value){const l=e.filteredOptions.value[0];l&&e.filterText.value.length&&e.onChooseOption(l)}})},"onSearch");ie(()=>e.model.value,l=>{var t;e.isBoth.value&&!((t=e.field.value)!=null&&t.multiple)&&(e.filter.value=`${l[0]}`)});const b=C(()=>{var t;const l={};return e.allOptions.value[e.focusOption.value]&&(l["aria-activedescendant"]=`${(t=e.allOptions.value[e.focusOption.value])==null?void 0:t.key}`),l});return()=>P("input",{ref:e.comboboxNode,id:e.field.value.id,value:e.filter.value,type:"text",name:e.field.value.id,role:"combobox",tabindex:0,placeholder:e.field.value.placeholder,"aria-autocomplete":e.autocomplete.value,"aria-expanded":e.isOpen.value,"aria-controls":`${e.field.value.name}-listbox`,...b.value,onInput:l=>{const t=l.target;y.value&&clearTimeout(y.value),e.isBusy.value=!0,e.filter.value=t.value,y.value=setTimeout(()=>i(),500)},onClick:$(l=>{e.isOpen.value?e.close(l,!0):e.open()},["stop"]),onKeydown:$(l=>{var p,s,r;let t=!1;const L=l.altKey;switch(l.key){case"Enter":if(e.isOpen.value&&e.focusOption.value!=-1){const d=e.filteredOptions.value[e.focusOption.value];d&&(e.onChooseOption(d,!0),e.onSetValue()),e.field.value.multiple||(e.close(l,!0),e.onFilterOptions(!0))}else{console.log("add custom",e.filter.value);const d=[...e.model.value];d.push(e.filter.value),e.filter.value="",e.filterText.value="",e.model.value=d}e.filterText.value="",t=!0;break;case"ArrowDown":case"Down":if(e.hasOptions)if(L)!e.isOpen.value&&e.open();else{!e.isOpen.value&&e.open(),e.onChangeActiveIndex(l);const d=e.filteredOptions.value[e.focusOption.value];d&&e.isBoth.value&&e.onChooseOption(d,!0),e.onSetFocusOption(),V(()=>{var x;(x=e.comboboxNode.value)==null||x.focus(),e.filterText.value=""})}t=!0;break;case"Up":case"ArrowUp":if(e.hasOptions)if(L)e.open();else{e.isOpen.value?e.onChangeActiveIndex(l):(e.open(),e.onChangeActiveIndex(l,e.filteredOptions.value.length-1)),e.onSetFocusOption();const d=e.filteredOptions.value[e.focusOption.value];d&&e.isBoth.value&&e.onChooseOption(d),V(()=>{var x;(x=e.comboboxNode.value)==null||x.focus(),e.filterText.value=""})}t=!0;break;case"Esc":case"Escape":e.isOpen.value?(e.close(l,!0),(p=e.comboboxNode.value)==null||p.setSelectionRange(e.filter.value.length,e.filter.value.length)):(e.model.value=[],e.filter.value="",e.filterText.value=""),e.onFilterOptions(!0),t=!0;break;case"Tab":e.close(l,!0);break;case"Home":if(l.shiftKey)break;(s=e.comboboxNode.value)==null||s.setSelectionRange(0,0),t=!0;break;case"End":if(l.shiftKey)break;(r=e.comboboxNode.value)==null||r.setSelectionRange(e.filter.value.length,e.filter.value.length),t=!0;break}t&&(l.stopPropagation(),l.preventDefault())},[]),onKeyup:$(l=>{let t=!1;const L=l.key;if(!(l.key==="Escape"||l.key==="Esc")){switch(l.key){case"Backspace":e.onFilterOptions(),t=!0;break;case"Left":case"ArrowLeft":case"Right":case"ArrowRight":case"Home":case"End":e.isBoth.value;break;default:we(L)&&(t=!0);break}t&&(l.stopPropagation(),l.preventDefault())}},[]),onFocus:()=>{},onBlur:()=>{}},v.default?v.default({}):[])}}),Le=E({name:"LComboboxButton",setup(o,{slots:v}){const e=J(H);if(!e){console.info("LComboboxButton must be nested to LCombobox component");return}return()=>{var y;return P("div",{ref:e.comboboxNode,id:e.field.value.id,name:e.field.value.id,role:"combobox",tabindex:0,"aria-labelledby":`${e.field.value.id}_label`,"aria-expanded":e.isOpen.value,"aria-controls":`${e.field.value.name}-listbox`,"aria-activedescendant":`${((y=e.allOptions.value[e.focusOption.value])==null?void 0:y.key)||""}`,onClick:$(i=>{e.isOpen.value?e.close(i,!0):e.open()},[]),onKeydown:$(i=>{let b=!1;const l=i.altKey;switch(i.key){case"Enter":if(e.isOpen.value&&e.focusOption.value!=-1){const t=e.filteredOptions.value[e.focusOption.value];t&&(e.onChooseOption(t,!0),e.onSetValue()),e.field.value.multiple||e.close(i,!0)}b=!0;break;case"ArrowDown":case"Down":e.hasOptions&&(l?!e.isOpen.value&&e.open():(e.isOpen.value?e.onChangeActiveIndex(i):(e.open(),e.focusOption.value<=0&&(e.focusOption.value=0),e.onChangeActiveIndex(i,e.focusOption.value)),e.onSetFocusOption(),V(()=>{var t;(t=e.comboboxNode.value)==null||t.focus()}))),b=!0;break;case"Up":case"ArrowUp":e.hasOptions&&(l?e.open():(e.isOpen.value?e.onChangeActiveIndex(i):(e.open(),e.focusOption.value<=0&&(e.focusOption.value=e.filteredOptions.value.length-1),e.onChangeActiveIndex(i,e.focusOption.value)),e.onSetFocusOption(),V(()=>{var t;(t=e.comboboxNode.value)==null||t.focus(),e.filterText.value=""}))),b=!0;break;case"Esc":case"Escape":e.isOpen.value?e.close(i,!0):(e.model.value=[],e.filter.value="",e.filterText.value=""),b=!0;break;case"Tab":e.close(i,!0);break}b&&(i.stopPropagation(),i.preventDefault())},[])},v.default?v.default({}):[])}}}),Ie=E({name:"LComboboxOptions",props:{as:{type:String,default:"ul"}},setup(o,{slots:v}){const e=J(H);if(!e){console.info("LComboboxOptions must be nested to LCombobox component");return}return()=>P(o.as,{ref:e.listboxNode,id:`${e.field.value.id}-listbox`,role:"listbox","aria-labelledby":`${e.field.value.id}`,onKeydown:$(y=>{},["stop"]),onPointerup:()=>{},onPointerover:()=>{e.hasHover.value=!0},onPointerout:()=>{e.hasHover.value=!1}},v.default?v.default({options:e.filteredOptions.value,hasOptions:e.hasOptions.value}):[])}}),Se=E({props:{as:{type:String,default:"li"},value:{type:[String,Number,Object],default:""}},name:"LComboboxOption",setup(o,{slots:v}){const e=J(H);if(!e){console.info("LComboboxOption must be nested to LComboboxOptions component");return}const y=f(null),i=Oe(),b=C(()=>e.field.value.keyValue&&typeof o.value=="object"?o.value[e.field.value.keyValue]:o.value),l=C(()=>e.model.value.includes(e.field.value.keyValue&&typeof o.value=="object"?o.value[e.field.value.keyValue]:o.value)),t=C(()=>{const p=e.field.value.keyValue,s=e.filteredOptions.value[e.focusOption.value];let r=!1;return s&&(r=(p&&typeof o.value=="object"?o.value[p]:o.value)==(p&&typeof s=="object"?s[p]:s)),r});se(()=>{e.allOptions.value.push({index:b.value,key:`${e.field.value.id}-option-${i}`,el:y.value})});const L=C(()=>e==null?void 0:e.allOptions.value.findIndex(p=>p.key==b.value));return ve(()=>{e==null||e.allOptions.value.splice(L.value,1)}),()=>P(o.as,{ref:y,id:`${e.field.value.id}-option-${i}`,role:"option","aria-disabled":!1,tabindex:-1,"aria-selected":l.value===!0?l.value:void 0,onKeydown:$(p=>{},["stop"]),onPointerup:()=>{},onPointerover:()=>{e.hasHover.value=!0},onPointerout:()=>{e.hasHover.value=!1},onClick:$(p=>{var s;e.onChooseOption(o.value),e.onSetValue(),(s=e.field.value)!=null&&s.multiple||e.close(p,!0),e.isNone||e.onFilterOptions(!0),V(()=>{var r;(r=e.comboboxNode.value)==null||r.focus()})},["stop"])},v.default?v.default({selected:l.value,hovered:t.value}):e.field.value.keyValue&&typeof o.value=="object"?o.value[e.field.value.keyValue]:o.value)}}),Ne={class:B(["outline-none flex space-x-2 items-center w-full transition"])},$e={class:"flex-auto flex flex-wrap m-1"},Fe={key:0},Ae={key:1,class:"text-s-400"},Be={class:"py-2 pr-2"},Ee={class:"absolute right-8 top-0 h-full flex items-center"},Te={class:B(["flex items-center h-6 w-6 mr-2"])},De={key:1,class:"p-2"},Re=E({name:"FCombobox",inheritAttrs:!1}),je=E({...Re,props:{modelValue:null,error:null,field:null,required:{type:Boolean}},emits:["update:modelValue","onInput","onLoadItems","onChoose"],setup(o,{emit:v}){const e=o,y=ke,i=C({get(){return e.modelValue},set(s){v("update:modelValue",s)}}),b=C(()=>{let s=!0;switch(typeof i.value){case"string":s=i.value=="";break;case"number":s=i.value==0;break;default:Array.isArray(i.value)&&(s=i.value.length==0);break}return s}),l=f(null),t=O(()=>{var r;const s=(r=l.value)==null?void 0:r.$el;s&&s.focus()},"onSetFocus"),L=O(async()=>{let s=0;switch(typeof i.value){case"string":s="";break;default:s=[];break}i.value=s,await v("onInput"),await t()},"onReset"),p=f(!1);return(s,r)=>(g(),I(G,null,[F(s.$slots,"label",{id:o.field.id,required:o.required,onSetFocus:t}),A("div",{class:B(["flex items-center cursor-pointer",["rounded-md border text-base transition w-full appearance-none outline-none focus-within:ring-1 hover:ring-1  bg-white dark:bg-s-900",{"border-d-500 dark:border-d-500 focus-within:ring-d-500 focus-within:border-d-500 hover:ring-d-500":o.error},(p.value,""),{"border-s-200 dark:border-s-600 focus-within:ring-p-500 focus-within:border-p-500 hover:ring-p-500 hover:border-p-500":!o.error}]])},[F(s.$slots,"before"),Z(m(Ce),me(s.$attrs,{modelValue:m(i),"onUpdate:modelValue":r[0]||(r[0]=d=>be(i)?i.value=d:null),"show-list":p.value,"onUpdate:show-list":r[1]||(r[1]=d=>p.value=d),field:o.field,error:o.error,class:"relative flex-auto",onOnLoadItems:r[2]||(r[2]=d=>s.$emit("onLoadItems")),onOnInput:r[3]||(r[3]=d=>s.$emit("onInput",d)),onOnChoose:r[4]||(r[4]=d=>s.$emit("onChoose",d))}),{default:T(({isOpen:d,isBusy:x,isNone:Q,selectedOptions:W})=>[A("div",Ne,[A("div",$e,[Q?(g(),q(m(Le),{key:0,ref_key:"inputElement",ref:l,autocomplete:"off",class:"w-full px-2 py-1 outline-none bg-transparent"},{default:T(()=>[m(i)?(g(),I("div",Fe,D(m(i)),1)):(g(),I("div",Ae,D(o.field.placeholder),1))]),_:1},512)):(g(),I(G,{key:1},[F(s.$slots,"selected-options",{selectedOptions:W},()=>[(g(!0),I(G,null,le(m(i),(R,S)=>(g(),I("div",{key:S,class:"float-left px-2 bg-s-300 dark:bg-s-700 rounded-md mr-1 mb-1"},D(R),1))),128))]),Z(m(Ve),{ref_key:"inputElement",ref:l,autocomplete:"off",class:"px-2 py-1 cursor-text outline-none bg-transparent placeholder-s-400"},null,512)],64))]),A("div",Be,[x?(g(),q(m(xe),{key:0})):(g(),q(m(ne),{key:1,class:B(["transition-transform",{"rotate-180":d}])},{default:T(()=>[_(D(m(ye)),1)]),_:2},1032,["class"]))]),A("div",Ee,[F(s.$slots,"after",{onReset:L,empty:m(b)})])]),ae(A("div",{class:B(["z-10 mt-1.5 transition overflow-hidden shadow-2xl outline-none border border-s-200 dark:border-s-700 rounded-md absolute top-full left-0 right-0 bg-white dark:bg-s-800",[d?"block":"hidden",(o.error,""),{"border-d-500 dark:border-d-500 focus-within:ring-d-500 focus-within:border-d-500":o.error},(p.value,""),{"border-s-200 dark:border-s-600 focus-within:ring-p-500 focus-within:border-p-500":!o.error}]])},[Z(m(Ie),{class:"max-h-64 b-scroll overflow-y-auto"},{default:T(({options:R,hasOptions:S})=>[S?(g(!0),I(G,{key:0},le(R,N=>(g(),q(m(Se),{key:o.field.keyValue?N[o.field.keyValue]:N,value:N,class:"group relative overflow-hidden"},{default:T(({selected:j,hovered:U})=>[F(s.$slots,"option",{option:N,selected:j},()=>[ae((g(),I("div",{class:B(["flex p-2 items-center cursor-pointer focus:outline-none",U?"bg-p-200 dark:bg-p-800 text-black dark:text-white group-focus:bg-p-200 group-hover:bg-p-200 dark:group-hover:bg-p-800 dark:group-focus:bg-p-800":"bg-transparent text-black dark:text-white group-focus:bg-p-100 group-hover:bg-p-100 dark:group-hover:bg-p-900 dark:group-focus:bg-p-900"])},[A("div",Te,[j?(g(),q(m(ne),{key:0,class:B(["text-xl",{"text-p-500 dark:text-p-500":j}])},{default:T(()=>[_(D(m(ge)),1)]),_:2},1032,["class"])):te("",!0)]),_(" "+D(o.field.keyLabel?N[o.field.keyLabel]:N),1)],2)),[[m(y),{}]])])]),_:2},1032,["value"]))),128)):(g(),I("div",De,"None options"))]),_:3})],2),[[he,d]])]),_:3},16,["modelValue","show-list","field","error"])],2),o.error?F(s.$slots,"error",{key:0,error:o.error}):te("",!0),F(s.$slots,"description")],64))}});je.__docgenInfo={exportName:"default",displayName:"FCombobox",description:"",tags:{},props:[{name:"modelValue",description:"modelValue - model string",required:!0,type:{name:"TComboboxModel"}},{name:"error",required:!1,type:{name:"string"}},{name:"field",description:"Schema for field.",required:!0,type:{name:"IField"}},{name:"required",required:!1,type:{name:"boolean"}}],events:[{name:"onLoadItems"},{name:"onInput"},{name:"onChoose"},{name:"update:modelValue"}],slots:[{name:"label",scoped:!0,bindings:[{name:"id",title:"binding"},{name:"required",title:"binding"},{name:"onSetFocus",title:"binding"}]},{name:"before"},{name:"selected-options",scoped:!0,bindings:[{name:"selected-options",title:"binding"}]},{name:"after",scoped:!0,bindings:[{name:"on-reset",title:"binding"},{name:"empty",title:"binding"}]},{name:"option",scoped:!0,bindings:[{name:"option",title:"binding"},{name:"selected",title:"binding"}]},{name:"error",scoped:!0,bindings:[{name:"error",title:"binding"}]},{name:"description"}]};export{je as _};
//# sourceMappingURL=FCombobox.c40d8232.js.map
