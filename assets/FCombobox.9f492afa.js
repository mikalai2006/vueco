var ce=Object.defineProperty;var O=(o,p)=>ce(o,"name",{value:p,configurable:!0});import{d as A,e as S,r as f,j as ne,k as ie,n as L,h as P,l as $,p as fe,q as ve,t as G,v as pe,o as g,x as N,i as E,g as F,y as Y,w as B,m as be,u as m,z as me,A as I,F as M,a as H,B as T,C as oe,D as te,b as Z,f as le,E as he}from"./vue.esm-bundler.4710087e.js";import{u as ye,i as Oe,a as ge}from"./useIcon.48b70701.js";import{L as xe}from"./LSpinner.94cc8f29.js";import{L as ae}from"./LIcon.9826c8a0.js";const ke=O(o=>o.length===1&&o.match(/\S| /),"isPrintableCharacter"),K=Symbol("ComboboxContext"),we=A({props:{modelValue:{type:[Array,String,Number],default:()=>[]},field:{type:Object,required:!0,default:()=>({})},error:{type:String,default:""},showList:{type:Boolean,default:!1}},emits:["update:showList","update:modelValue","onLoadItems","on-input"],setup(o,{slots:p,emit:e}){const u=S(()=>{var n;return((n=o.field)==null?void 0:n.autocomplete)||"none"}),r=f(!1),b=f(!1),l=f(!1),t=f(o.field),x=f(-1),i=S(()=>W.value.length>0),d=f(null),h=f(!1),v=f(!1),k=f(!1),J=S(()=>{var n;return((n=t.value)==null?void 0:n.disabled)||k.value||!1}),D=f(!1),j=f(!1),C=f(null),R=f(null),Q=f([]),se=S({get(){return o.field.multiple&&Array.isArray(o.modelValue)?[...o.modelValue]:[o.modelValue]},set(n){const c=t.value.multiple?n:n[0];e("update:modelValue",c),e("on-input")}}),U=f(""),ue=f(""),W=f([]),X=O(n=>{console.time("onFilterOptions"),typeof n!="boolean"&&(n=!1);const c=U.value.toLowerCase();let s=[];const w=t.value.keyFilter,V=t.value.items||[];return(r.value||U.value.length===0)&&!n?s=V:w&&(s=V.filter(y=>typeof y=="object"?y[w].toLowerCase().indexOf(c)===0:typeof y=="number"?y!==-1:y.toLowerCase().indexOf(c)===0).sort((y,z)=>a.model.value.indexOf(y[w])-a.model.value.indexOf(z[w]))),W.value=s,console.timeEnd("onFilterOptions"),s},"onFilterOptions");if(ne(()=>o.field.items,()=>{X()}),t.value.autocomplete)if(typeof t.value.autocomplete=="string"){const n=t.value.autocomplete.toLowerCase();r.value=n==="none",b.value=n==="list",l.value=n==="both"}else r.value=!0;const re=O(()=>{h.value=!0,setTimeout(()=>{ee()},10),L(()=>{var n;a.isNone.value||(n=C.value)==null||n.setSelectionRange(0,a.filter.value.length)})},"open"),q=O((n,c)=>{var w,V;if(typeof c!="boolean"&&(c=!1),!n)return;const s=n.target;(c||!((w=a.listboxNode.value)!=null&&w.contains(s))&&a.comboboxNode.value!=s)&&(_(),h.value=!1,(V=C.value)==null||V.focus(),a.focusOption.value=-1,t.value.multiple||L(()=>{var y;a.isNone.value||(y=C.value)==null||y.setSelectionRange(a.filter.value.length,a.filter.value.length)}))},"close"),_=O(()=>{document&&(document.removeEventListener("click",q),document.removeEventListener("keyup",q))},"unRegisterOverlay"),ee=O(()=>{document&&(document.addEventListener("click",q),document.addEventListener("keyup",q))},"registerOverlay"),a={autocomplete:u,isNone:r,isBoth:l,isList:b,field:t,comboboxNode:C,listboxNode:R,focusOption:x,hasOptions:i,filter:U,filterText:ue,option:d,allOptions:Q,filteredOptions:W,model:se,comboboxHasVisualFocus:D,listboxHasVisualFocus:j,hasHover:v,isOpen:h,isBusy:k,isDisabled:J,open:re,close:q,registerOverlay:ee,unRegisterOverlay:_,onChangeActiveIndex:O((n,c)=>{let s=a.focusOption.value||0;return c||c===0?s=c:(n.key==="ArrowDown"?s++:n.key==="ArrowUp"&&s--,s>a.allOptions.value.length-1&&(s=a.allOptions.value.length-1),s<0&&(s=0)),a.focusOption.value=s,s},"onChangeActiveIndex"),onSetFocusOption:O(()=>{const n=a.field.value.keyValue;L(()=>{var w;const c=a.filteredOptions.value[a.focusOption.value];if(!c)return;const s=a.allOptions.value.find(V=>V.index===(n&&typeof c=="object"?c[n]:c));s!=null&&s.el&&((w=s.el)==null||w.focus())})},"onSetFocusOption"),onChooseOption:O((n,c)=>{typeof c!="boolean"&&(c=!1);const s=a.field.value.keyValue&&typeof n=="object"?n[a.field.value.keyValue]:n,w=a.model.value.findIndex(y=>y===s);let V=[...a.model.value];a.field.value.multiple?(w!==-1?V.splice(w,1):V.push(s),a.filter.value=`${s}`):(V=[s],a.filter.value=`${s}`),r.value||L(()=>{var y,z;c?(y=a.comboboxNode.value)==null||y.setSelectionRange(0,a.filter.value.length):(z=a.comboboxNode.value)==null||z.setSelectionRange(a.filterText.value.length,a.filter.value.length)})},"onChooseOption"),onFilterOptions:X,onSetValue:O(()=>{if(t.value.multiple){const n=[...a.model.value],c=a.model.value.findIndex(s=>s==a.filter.value);c!=-1?n.splice(c,1):n.push(a.filter.value),a.model.value=n,U.value=""}else a.model.value=[a.filter.value];a.onFilterOptions(),console.groupEnd()},"onSetValue")},de=O(async()=>{k.value=!0,await e("onLoadItems"),k.value=!1},"loadData");return ie(async()=>{await de(),L(()=>{var n;t.value.autofocus&&((n=a.comboboxNode.value)==null||n.focus())}),await X()}),ve(K,a),()=>P("div",null,{default:()=>p.default?p.default({isNone:r.value,isOpen:h.value,isBusy:k.value}):[]})}}),Ce=A({name:"LComboboxInput",setup(o,{slots:p}){const e=G(K);if(!e){console.info("LComboboxInput must be nested to LCombobox component");return}const u=f(null),r=O(()=>{e.filterText.value=e.filter.value,e.isBusy.value=!1,e.focusOption.value=-1,!e.isOpen.value&&e.open(),e.onFilterOptions(),L(()=>{if(e.isBoth.value){const l=e.filteredOptions.value[0];l&&e.filterText.value.length&&e.onChooseOption(l)}})},"onSearch");ne(()=>e.model.value,l=>{var t;e.isBoth.value&&!((t=e.field.value)!=null&&t.multiple)&&(e.filter.value=`${l[0]}`)});const b=S(()=>{var t;const l={};return e.allOptions.value[e.focusOption.value]&&(l["aria-activedescendant"]=`${(t=e.allOptions.value[e.focusOption.value])==null?void 0:t.key}`),l});return()=>P("input",{ref:e.comboboxNode,id:e.field.value.id,value:e.filter.value,type:"text",name:e.field.value.id,role:"combobox",tabindex:0,placeholder:e.field.value.placeholder,"aria-autocomplete":e.autocomplete.value,"aria-expanded":e.isOpen.value,"aria-controls":`${e.field.value.name}-listbox`,...b.value,onInput:l=>{const t=l.target;u.value&&clearTimeout(u.value),e.isBusy.value=!0,e.filter.value=t.value,u.value=setTimeout(()=>r(),500)},onClick:$(l=>{e.isOpen.value?e.close(l,!0):e.open()},["stop"]),onKeydown:$(l=>{var i,d,h;let t=!1;const x=l.altKey;switch(l.key){case"Enter":if(e.isOpen.value&&e.focusOption.value!=-1){const v=e.filteredOptions.value[e.focusOption.value];v&&(e.onChooseOption(v,!0),e.onSetValue()),e.field.value.multiple||(e.close(l,!0),e.onFilterOptions(!0))}e.filterText.value="",t=!0;break;case"ArrowDown":case"Down":if(e.hasOptions)if(x)!e.isOpen.value&&e.open();else{!e.isOpen.value&&e.open(),e.onChangeActiveIndex(l);const v=e.filteredOptions.value[e.focusOption.value];v&&e.isBoth.value&&e.onChooseOption(v,!0),e.onSetFocusOption(),L(()=>{var k;(k=e.comboboxNode.value)==null||k.focus(),e.filterText.value=""})}t=!0;break;case"Up":case"ArrowUp":if(e.hasOptions)if(x)e.open();else{e.isOpen.value?e.onChangeActiveIndex(l):(e.open(),e.onChangeActiveIndex(l,e.filteredOptions.value.length-1)),e.onSetFocusOption();const v=e.filteredOptions.value[e.focusOption.value];v&&e.isBoth.value&&e.onChooseOption(v),L(()=>{var k;(k=e.comboboxNode.value)==null||k.focus(),e.filterText.value=""})}t=!0;break;case"Esc":case"Escape":e.isOpen.value?(e.close(l,!0),(i=e.comboboxNode.value)==null||i.setSelectionRange(e.filter.value.length,e.filter.value.length)):(e.model.value=[],e.filter.value="",e.filterText.value=""),e.onFilterOptions(!0),t=!0;break;case"Tab":e.close(l,!0);break;case"Home":(d=e.comboboxNode.value)==null||d.setSelectionRange(0,0),t=!0;break;case"End":(h=e.comboboxNode.value)==null||h.setSelectionRange(e.filter.value.length,e.filter.value.length),t=!0;break}t&&(l.stopPropagation(),l.preventDefault())},[]),onKeyup:$(l=>{let t=!1;const x=l.key;if(!(l.key==="Escape"||l.key==="Esc")){switch(l.key){case"Backspace":e.onFilterOptions(),t=!0;break;case"Left":case"ArrowLeft":case"Right":case"ArrowRight":case"Home":case"End":e.isBoth.value;break;default:ke(x)&&(t=!0);break}t&&(l.stopPropagation(),l.preventDefault())}},[]),onFocus:()=>{},onBlur:()=>{}},p.default?p.default({}):[])}}),Ve=A({name:"LComboboxButton",setup(o,{slots:p}){const e=G(K);if(!e){console.info("LComboboxButton must be nested to LCombobox component");return}return()=>{var u;return P("div",{ref:e.comboboxNode,id:e.field.value.id,name:e.field.value.id,role:"combobox",tabindex:0,"aria-labelledby":`${e.field.value.id}_label`,"aria-expanded":e.isOpen.value,"aria-controls":`${e.field.value.name}-listbox`,"aria-activedescendant":`${((u=e.allOptions.value[e.focusOption.value])==null?void 0:u.key)||""}`,onClick:$(r=>{e.isOpen.value?e.close(r,!0):e.open()},[]),onKeydown:$(r=>{let b=!1;const l=r.altKey;switch(r.key){case"Enter":if(e.isOpen.value&&e.focusOption.value!=-1){const t=e.filteredOptions.value[e.focusOption.value];t&&(e.onChooseOption(t,!0),e.onSetValue()),e.field.value.multiple||e.close(r,!0)}b=!0;break;case"ArrowDown":case"Down":e.hasOptions&&(l?!e.isOpen.value&&e.open():(e.isOpen.value?e.onChangeActiveIndex(r):(e.open(),e.focusOption.value<=0&&(e.focusOption.value=0),e.onChangeActiveIndex(r,e.focusOption.value)),e.onSetFocusOption(),L(()=>{var t;(t=e.comboboxNode.value)==null||t.focus()}))),b=!0;break;case"Up":case"ArrowUp":e.hasOptions&&(l?e.open():(e.isOpen.value?e.onChangeActiveIndex(r):(e.open(),e.focusOption.value<=0&&(e.focusOption.value=e.filteredOptions.value.length-1),e.onChangeActiveIndex(r,e.focusOption.value)),e.onSetFocusOption(),L(()=>{var t;(t=e.comboboxNode.value)==null||t.focus(),e.filterText.value=""}))),b=!0;break;case"Esc":case"Escape":e.isOpen.value?e.close(r,!0):(e.model.value=[],e.filter.value="",e.filterText.value=""),b=!0;break;case"Tab":e.close(r,!0);break;case"Home":b=!0;break;case"End":b=!0;break}b&&(r.stopPropagation(),r.preventDefault())},[])},p.default?p.default({}):[])}}}),Le=A({name:"LComboboxOptions",props:{as:{type:String,default:"ul"}},setup(o,{slots:p}){const e=G(K);if(!e){console.info("LComboboxOptions must be nested to LCombobox component");return}return()=>P(o.as,{ref:e.listboxNode,id:`${e.field.value.id}-listbox`,role:"listbox","aria-labelledby":`${e.field.value.id}`,onKeydown:$(u=>{},["stop"]),onPointerup:()=>{},onPointerover:()=>{e.hasHover.value=!0},onPointerout:()=>{e.hasHover.value=!1}},p.default?p.default({options:e.filteredOptions.value,hasOptions:e.hasOptions.value}):[])}}),Se=A({props:{as:{type:String,default:"li"},value:{type:[String,Number,Object],default:""}},name:"LComboboxOption",setup(o,{slots:p}){const e=G(K);if(!e){console.info("LComboboxOption must be nested to LComboboxOptions component");return}const u=f(null),r=ye(),b=S(()=>e.field.value.keyValue&&typeof o.value=="object"?o.value[e.field.value.keyValue]:o.value),l=S(()=>e.model.value.includes(e.field.value.keyValue&&typeof o.value=="object"?o.value[e.field.value.keyValue]:o.value)),t=S(()=>{const i=e.field.value.keyValue,d=e.filteredOptions.value[e.focusOption.value];let h=!1;return d&&(h=(i&&typeof o.value=="object"?o.value[i]:o.value)==(i&&typeof d=="object"?d[i]:d)),h});ie(()=>{e.allOptions.value.push({index:b.value,key:`${e.field.value.id}-option-${r}`,el:u.value})});const x=S(()=>e==null?void 0:e.allOptions.value.findIndex(i=>i.key==b.value));return fe(()=>{e==null||e.allOptions.value.splice(x.value,1)}),()=>P(o.as,{ref:u,id:`${e.field.value.id}-option-${r}`,role:"option","aria-disabled":!1,tabindex:-1,"aria-selected":l.value===!0?l.value:void 0,onKeydown:$(i=>{},["stop"]),onPointerup:()=>{},onPointerover:()=>{e.hasHover.value=!0},onPointerout:()=>{e.hasHover.value=!1},onClick:$(i=>{var d;e.onChooseOption(o.value),e.onSetValue(),(d=e.field.value)!=null&&d.multiple||e.close(i,!0),e.isNone||e.onFilterOptions(!0),L(()=>{var h;(h=e.comboboxNode.value)==null||h.focus()})},["stop"])},p.default?p.default({selected:l.value,hovered:t.value}):e.field.value.keyValue&&typeof o.value=="object"?o.value[e.field.value.keyValue]:o.value)}}),Ne={class:I(["outline-none flex space-x-2 items-center w-full transition"])},$e={class:"flex-auto flex flex-wrap m-1"},Fe={key:0},Ie={key:1,class:"text-s-400"},Ae={key:0,class:"flex flex-row flex-wrap"},Ee={class:"py-2 pr-2"},Be={class:"absolute right-8 top-0 h-full flex items-center"},Te={class:I(["flex items-center h-6 w-6 mr-2"])},De={key:1,class:"p-2"},je=A({name:"FCombobox",inheritAttrs:!1}),Re=A({...je,props:{modelValue:null,error:null,field:null,required:{type:Boolean}},emits:["update:modelValue","on-input","on-load-items"],setup(o,{emit:p}){const e=o,u=S({get(){return e.modelValue},set(i){p("update:modelValue",i)}}),r=S(()=>{let i=!0;switch(typeof u.value){case"string":i=u.value=="";break;case"number":i=u.value==0;break;default:Array.isArray(u.value)&&(i=u.value.length==0);break}return i}),b=f(null),l=O(()=>{var d;const i=(d=b.value)==null?void 0:d.$el;i&&i.focus()},"onSetFocus"),t=O(async()=>{let i=0;switch(typeof u.value){case"string":i="";break;default:i=[];break}u.value=i,await p("on-input"),await l()},"onReset"),x=f(!1);return(i,d)=>{const h=pe("ripple");return g(),N(M,null,[E(i.$slots,"label",{id:o.field.id,required:o.required,onSetFocus:l}),F("div",{class:I(["flex items-center cursor-pointer",["rounded-md border text-base transition w-full appearance-none outline-none focus-within:ring-1 hover:ring-1  bg-white dark:bg-s-900",{"border-d-500 dark:border-d-500 focus-within:ring-d-500 focus-within:border-d-500 hover:ring-d-500":o.error},(x.value,""),{"border-s-200 dark:border-s-600 focus-within:ring-p-500 focus-within:border-p-500 hover:ring-p-500 hover:border-p-500":!o.error}]])},[E(i.$slots,"before"),Y(m(we),be(i.$attrs,{modelValue:m(u),"onUpdate:modelValue":d[0]||(d[0]=v=>me(u)?u.value=v:null),showList:x.value,"onUpdate:showList":d[1]||(d[1]=v=>x.value=v),field:o.field,error:o.error,class:"relative flex-auto",onOnLoadItems:d[2]||(d[2]=v=>i.$emit("on-load-items")),onOnInput:d[3]||(d[3]=v=>i.$emit("on-input"))}),{default:B(({isOpen:v,isBusy:k,isNone:J})=>[F("div",Ne,[F("div",$e,[J?(g(),H(m(Ve),{key:0,ref_key:"inputElement",ref:b,autocomplete:"off",class:"w-full px-2 py-1 outline-none bg-transparent"},{default:B(()=>[m(u)?(g(),N("div",Fe,T(m(u)),1)):(g(),N("div",Ie,T(o.field.placeholder),1))]),_:1},512)):(g(),N(M,{key:1},[typeof m(u)=="object"&&o.field.multiple?(g(),N("div",Ae,[(g(!0),N(M,null,oe(m(u),(D,j)=>(g(),N("div",{key:j,class:"px-2 bg-s-300 dark:bg-s-700 rounded-md mr-1 mb-1"},T(D),1))),128))])):te("",!0),Y(m(Ce),{ref_key:"inputElement",ref:b,autocomplete:"off",class:"w-full px-2 py-1 cursor-text outline-none bg-transparent placeholder-s-400"},null,512)],64))]),F("div",Ee,[k?(g(),H(m(xe),{key:0})):(g(),H(m(ae),{key:1,class:I(["transition-transform",{"rotate-180":v}])},{default:B(()=>[Z(T(m(Oe)),1)]),_:2},1032,["class"]))]),F("div",Be,[E(i.$slots,"after",{onReset:t,empty:m(r)})])]),le(F("div",{class:I(["z-10 mt-1.5 transition overflow-hidden shadow-2xl outline-none border border-s-200 dark:border-s-700 rounded-md absolute top-full left-0 right-0 bg-white dark:bg-s-800",[v?"block":"hidden",(o.error,""),{"border-d-500 dark:border-d-500 focus-within:ring-d-500 focus-within:border-d-500":o.error},(x.value,""),{"border-s-200 dark:border-s-600 focus-within:ring-p-500 focus-within:border-p-500":!o.error}]])},[Y(m(Le),{class:"max-h-64 b-scroll overflow-y-auto"},{default:B(({options:D,hasOptions:j})=>[j?(g(!0),N(M,{key:0},oe(D,C=>(g(),H(m(Se),{key:o.field.keyValue?C[o.field.keyValue]:C,value:C,class:"group relative overflow-hidden"},{default:B(({selected:R,hovered:Q})=>[E(i.$slots,"option",{option:C,selected:R},()=>[le((g(),N("div",{class:I(["flex p-2 items-center cursor-pointer focus:outline-none",Q?"bg-p-200 dark:bg-p-800 text-black dark:text-white group-focus:bg-p-200 group-hover:bg-p-200 dark:group-hover:bg-p-800 dark:group-focus:bg-p-800":"bg-transparent text-black dark:text-white group-focus:bg-p-100 group-hover:bg-p-100 dark:group-hover:bg-p-900 dark:group-focus:bg-p-900"])},[F("div",Te,[R?(g(),H(m(ae),{key:0,class:I(["text-xl",{"text-p-500 dark:text-p-500":R}])},{default:B(()=>[Z(T(m(ge)),1)]),_:2},1032,["class"])):te("",!0)]),Z(" "+T(o.field.keyLabel?C[o.field.keyLabel]:C),1)],2)),[[h,{}]])])]),_:2},1032,["value"]))),128)):(g(),N("div",De,"None options"))]),_:3})],2),[[he,v]])]),_:3},16,["modelValue","showList","field","error"])],2),E(i.$slots,"error",{error:o.error}),E(i.$slots,"description")],64)}}});Re.__docgenInfo={exportName:"default",displayName:"FCombobox",description:"",tags:{},props:[{name:"modelValue",description:"modelValue - model string",required:!0,type:{name:"TComboboxModel"}},{name:"error",required:!1,type:{name:"string"}},{name:"field",description:"Schema for field.",required:!0,type:{name:"IField"}},{name:"required",required:!1,type:{name:"boolean"}}],events:[{name:"on-load-items"},{name:"on-input"},{name:"update:modelValue"}],slots:[{name:"label",scoped:!0,bindings:[{name:"id",title:"binding"},{name:"required",title:"binding"},{name:"onSetFocus",title:"binding"}]},{name:"before"},{name:"after",scoped:!0,bindings:[{name:"on-reset",title:"binding"},{name:"empty",title:"binding"}]},{name:"option",scoped:!0,bindings:[{name:"option",title:"binding"},{name:"selected",title:"binding"}]},{name:"error",scoped:!0,bindings:[{name:"error",title:"binding"}]},{name:"description"}]};export{Re as _};
//# sourceMappingURL=FCombobox.9f492afa.js.map
