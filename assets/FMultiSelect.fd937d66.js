var fe=Object.defineProperty;var O=(t,v)=>fe(t,"name",{value:v,configurable:!0});import{d as C,r as y,f as ve,a as S,o as ue,n as N,h as R,g as W,F as P,i as pe,p as me,j as z,b as he,k as w,l as T,m as A,q as V,t as ee,u as F,v as ge,x as k,y as ye,z as D,C as le,A as M,D as j,B as I,E as U,w as be}from"./vue.esm-bundler.d6e8a8ce.js";import{u as te,i as ke,a as ne,d as we}from"./useIcon.1f824c76.js";import{L as Oe}from"./LSpinner.c9659ed3.js";import{L as _}from"./LIcon.b157f1df.js";const G=Symbol("SelectContext"),Se=C({name:"LMultiSelect",props:{modelValue:{type:[Array,String,Number],default:()=>[]},showField:{type:Boolean,default:!1},field:{type:Object,required:!0,default:()=>({})}},emits:["update:showList","update:modelValue","onLoadItems","on-input"],setup(t,{emit:v,slots:e,expose:s}){const h=O(i=>{var m,u,g;const n=i.target;!((m=o.selectButtonEl.value)!=null&&m.contains(n))&&!((u=o.listBoxEl.value)!=null&&u.contains(n))&&!((g=o.searchEl.value)!=null&&g.contains(n))&&(q.value=!1,c())},"close"),c=O(()=>{document.removeEventListener("click",h),document.removeEventListener("keyup",h),console.log("unRegisterOverlay")},"unRegisterOverlay"),a=O(()=>{document.addEventListener("click",h),document.addEventListener("keyup",h),console.log("registerOverlay")},"registerOverlay"),d=y(null),p=y([]),l=y(null),r=y(null),f=y(t.field),b=y(0),K=y(0),Q=y(!1),X=y(""),q=y(!1),L=y(!1),E=y(!1),J=y(""),H=y(0);ve(()=>q.value,i=>{v("update:showList",i)});const x=f.value.keyGroup||void 0,$=S({get(){return t.field.multiple&&Array.isArray(t.modelValue)?[...t.modelValue]:[t.modelValue]},set(i){const n=f.value.multiple?i:i[0];v("update:modelValue",n),v("on-input")}}),Y=S(()=>{console.time("filteredOptions");const i=f.value.items||[];let n=i;const m=f.value.keyFilter;return m&&(n=i.filter(u=>typeof u=="object"?u[m].toLowerCase().indexOf(J.value.toLowerCase())!==-1:typeof u=="number"?u!==-1:u.toLowerCase().indexOf(J.value.toLowerCase())!==-1).sort((u,g)=>o.model.value.indexOf(u[m])-o.model.value.indexOf(g[m]))),console.timeEnd("filteredOptions"),n}),B=S(()=>{const i=f.value.items||[],n=f.value.keyValue;let m=[];return m=i.filter(u=>o.model.value.includes(typeof u=="object"&&n?u[n]:u)).sort((u,g)=>o.model.value.indexOf(u[n])-o.model.value.indexOf(g[n])),m}),oe=S(()=>{var n,m;console.time("groupscomputed");const i={};return x||(i.default={selected:B.value.length||0,length:((n=f.value.items)==null?void 0:n.length)||0,key:"default"}),x&&((m=Y.value.sort((u,g)=>u[x].localeCompare(g[x])))==null||m.forEach(u=>{typeof u=="object"&&(i[u[x]]={selected:B.value.filter(g=>typeof g=="object"&&g[x]==u[x]).length,length:i[u[x]]?i[u[x]].length+1:1,key:u[x]})})),console.timeEnd("groupscomputed"),console.log("groups=",i),i});s({elselect:l});const Z=O(({range:i})=>{if(!f.value.multiple)return;const{from:n,to:m}=i;if(!f.value.items)return;const u=f.value.items.slice(n<m?n:m,m>n?m+1:n+1);o.model.value=JSON.parse(JSON.stringify(u.map(g=>f.value.keyValue&&typeof g=="object"?g[f.value.keyValue]:g))),console.log("chooseItemsOfRange"),console.log({range:i},o.model.value)},"chooseItemsOfRange"),ie=O(i=>{const n=o!=null&&o.field.value.keyValue?i[o.field.value.keyValue]:i,m=o.model.value.findIndex(g=>g===n);let u=[...o.model.value];o.field.value.multiple?m!==-1?u.splice(m,1):u.push(n):u=[n],o.model.value=u},"onChooseOption"),se=O(i=>{let n=o.focusOption.value||0;return o.focusOption.value==-1&&(n=0),i.key==="ArrowDown"?n++:i.key==="ArrowUp"&&n--,n>o.optionsEl.value.length-1&&(n=o.optionsEl.value.length-1),n<0&&(n=0),console.log("onChangeActiveIndex: newIndex=",n),n},"onChangeActiveIndex"),re=O(()=>{o.focusOption.value||(o.focusOption.value=0);const i=o.field.value.multiple?o.model.value[0]:o.model.value,n=o.field.value.keyValue,m=o.filteredOptions.value.findIndex(u=>n&&typeof u=="object"?u[n]==i:u==i);m&&m!=-1&&(o.focusOption.value=m),N(()=>{var ae;console.log("onSetFocus: index=",m," select.focusOption.value=",o.focusOption.value);const u=o.filteredOptions.value[o.focusOption.value],g=o.optionsEl.value.find(ce=>ce.key===(n?u[n]:u));g.el&&(console.log("elForFocus.el=",g.el),(ae=g.el)==null||ae.focus())})},"onSetFocus"),o={id:t.field.name,selectButtonEl:l,listBoxEl:r,searchEl:d,optionsEl:p,focusOption:H,model:$,field:f,show:q,loading:E,disabled:L,groups:oe,groupkey:x,selectedOptions:B,filteredOptions:Y,filterText:J,searchQuery:X,clearSearchQuery(){X.value!==""&&(X.value="")},pressShift:Q,indexShiftFrom:b,indexShiftTo:K,registerOverlay:a,unRegisterOverlay:c,chooseItemsOfRange:Z,onLoadItems:()=>v("onLoadItems"),updateModel:i=>{v("update:modelValue",i),v("on-input")},onChangeActiveIndex:se,onChooseOption:ie,onSetFocus:re};me(G,o);const de=O(async()=>{E.value=!0,L.value=!0,await v("onLoadItems"),E.value=!1,L.value=!1},"loadData");return ue(async()=>{await de(),f.value.autofocus&&N(()=>{var i;o.searchEl.value?o.searchEl.value.focus():(i=l.value)==null||i.focus()})}),()=>R("div",{},{default:()=>e.default?e.default({select:o,loading:E.value,disabled:L.value,show:o.show.value,filteredOptions:Y.value,focusOption:o.focusOption.value,indexShiftFrom:o.indexShiftFrom.value,indexShiftTo:o.indexShiftTo.value,selectedOptions:o.selectedOptions.value||[]}):[]})}}),xe=C({name:"LMultiSelectButton",setup(t,{slots:v}){const e=z(G);if(!e){console.info("%s must be use inner %s component!","LMultiSelectButton","LMultiSelect");return}const s=S(()=>{const c={};return e.show.value&&(c["aria-controls"]=`${e.field.value.name}-listbox`),c}),h=S(()=>e.searchEl.value?{}:{role:"button",type:"button",tabindex:0,disabled:e.disabled.value,"aria-expanded":e.show.value,"aria-haspopup":"listbox","aria-labelledby":e.field.value.label?`${e.field.value.name}_label`:void 0,...s.value});return()=>R(e.searchEl.value?"div":"button",{ref:e.selectButtonEl,id:`${e.id}-button`,...h.value,onClick:W(()=>{console.log("LMultiSelectButton: onClick"),e.show.value=!e.show.value,e.show.value?(N(()=>{e.onSetFocus()}),e.searchEl.value&&N(()=>{var c;(c=e.searchEl.value)==null||c.focus()}),setTimeout(()=>{e.registerOverlay()},50)):e.unRegisterOverlay()},[]),onKeydown:W(c=>{switch(console.log("LMultiSelectButton: onKeydown"),c.key){case"Enter":console.log("select.focusOption.value=",e.focusOption.value),e.onChooseOption(e.filteredOptions.value[e.focusOption.value]),e.field.value.multiple||N(()=>{var a,d;e.searchEl.value?(a=e.searchEl.value)==null||a.focus():(d=e.selectButtonEl.value)==null||d.focus({preventScroll:!0}),e.show.value=!1});break;case"ArrowUp":case"ArrowDown":console.log("Key press down"),e.show.value||(e.show.value=!0,e.registerOverlay()),e.show.value&&e.onChangeActiveIndex(c),N(()=>{e.onSetFocus()});break;case"Escape":e.show.value=!1,e.focusOption.value=0,e.unRegisterOverlay();break}},[])},v.default?v.default({show:e.show.value,disabled:e.disabled.value,loading:e.loading.value}):[])}}),Le=C({name:"LMultiSelectList",setup(t,{emit:v,slots:e}){const s=z(G),h=O(a=>{const d=s.model.value.findIndex(p=>p==(a[s.field.value.keyValue]||a));if(d!==-1){const p=[...s.model.value];p.splice(d,1),s.model.value=p}},"removeOption"),c=O(()=>{s.model.value.splice(s.model.value.length-1,1)},"removeLast");return()=>R(P,{},e.default?e.default({removeOption:h,onKeydown:a=>{a.key==="Backspace"&&c()}}):[])}}),Ee=C({name:"LMultiSelectSearch",setup(t,{slots:v}){const e=z(G,{}),s=y(""),h=y(null),c=O(()=>{e.filterText.value=s.value,e.loading.value=!1,e.show.value||(e.show.value=!0,setTimeout(()=>{e.registerOverlay()},50))},"onSearch");return()=>{var a;return R("input",{ref:d=>e.searchEl.value=d,role:"combobox",tabindex:0,placeholder:(a=e.field.value)==null?void 0:a.placeholder,disabled:e.disabled.value,"aria-expanded":e.show.value,"aria-haspopup":"listbox","aria-labelledby":e.field.value.label?`${e.field.value.name}_label`:void 0,"aria-controls":e.show.value?`${e.field.value.name}-listbox`:void 0,value:s.value,onInput:d=>{const p=d.target;h.value&&clearTimeout(h.value),e.loading.value=!0,h.value=setTimeout(()=>c(),350),s.value=p.value}})}}}),Ve=C({name:"LMultiSelectOptions",setup(t,{slots:v}){const e=z(G);if(!e)return;te();const s=S(()=>{const a={};return e.focusOption.value!=null&&e.focusOption.value!==-1&&(a["aria-activedescendant"]=`${e.id}-option-${e.focusOption.value}`),e.field.value.multiple&&(a["aria-multiselectable"]=!0),a}),h=O(()=>{var d,p;if(!e.field.value.multiple)return;const a=e.field.value.keyValue;if(e.model.value.length===((d=e.field.value.items)==null?void 0:d.length))e.model.value=[];else{const l=(p=e.field.value.items)==null?void 0:p.map(r=>a&&typeof r=="object"?r[a]:r);l&&(e.model.value=l)}},"toggleChooseAll"),c=y(null);return()=>R("div",{ref:e.listBoxEl,id:`${e.field.value.name}-listbox`,role:"listbox","aria-labelledby":`${e.field.value.name}-button`,tabindex:0,...s.value,onKeydown:W(a=>{var p,l,r;if(c.value&&clearTimeout(c.value),c.value=setTimeout(()=>e.clearSearchQuery(),350),console.log("Key press of options",a.key),a.ctrlKey&&a.key==="a"&&(h(),a.preventDefault()),a.key==="Escape"){e.focusOption.value=0,e.show.value=!1,e.searchEl.value?(p=e.searchEl.value)==null||p.focus():(l=e.selectButtonEl.value)==null||l.focus({preventScroll:!0});return}const d=e.onChangeActiveIndex(a);if(a.preventDefault(),d!==e.focusOption.value){e.focusOption.value=d;const f=e.field.value.keyValue,b=e.filteredOptions.value[d],K=e.optionsEl.value.find(Q=>Q.key==(f?b[f]:b));console.log("focus option = ",d,e.optionsEl.value),K&&((r=K.el)==null||r.focus())}a.shiftKey||(e.indexShiftFrom.value=d),a.shiftKey&&(a.key==="ArrowDown"||a.key==="ArrowUp")&&(e.indexShiftTo.value=e.focusOption.value,e.chooseItemsOfRange({range:{from:e.indexShiftFrom.value,to:e.indexShiftTo.value}}))},["stop"]),onKeyup:a=>{a.key==="Shift"&&(e.pressShift.value=!1,e.indexShiftFrom.value=0,e.indexShiftTo.value=0)},onFocus:()=>{console.log("LMultiSelectOptions: onFocus")}},v.default?v.default({groups:e==null?void 0:e.groups.value,options:e==null?void 0:e.filteredOptions.value}):[])}}),Fe=C({name:"LMultiSelectGroup",props:{group:{type:[String],default:"default",required:!0}},setup(t,{slots:v}){const e=z(G);if(!e)return;const s=te(),h=S(()=>e.groups.value[t.group]),c=O(()=>{if(console.time("chooseGroup"),!(e!=null&&e.field.value.multiple))return;const{length:p,selected:l}=h.value,r=e.field.value.items.filter(b=>e.groupkey?b[e.groupkey]===t.group:!0).map(b=>e.field.value.keyValue?b[e.field.value.keyValue]:b),f=p!==l?e.model.value.concat(r):e.model.value.filter(b=>r.indexOf(b)<0);e.model.value=f,console.timeEnd("chooseGroup")},"chooseGroup"),a=S(()=>{const p=e.field.value.keyFilter?e.filteredOptions.value:e.field.value.items;return e.groupkey?p.filter(l=>l[e.groupkey]===t.group):p}),d=S(()=>h.value.selected===h.value.length);return()=>R("div",{id:`${e==null?void 0:e.id}-group-${s}`,role:"group","aria-disabled":!1,onClick:W(()=>{c()},["stop"])},v.default?v.default({groupId:s,options:a.value,groupSelectedOption:h.value.selected,groupLength:h.value.length,groupSelect:d.value}):[])}}),Me=C({name:"LMultiSelectOption",props:{value:{type:[String,Number,Object],default:""}},setup(t,{slots:v}){const e=z(G),s=y(null),h=S(()=>e.field.value.keyValue?t.value[e.field.value.keyValue]:t.value);ue(()=>{e.optionsEl.value.push({key:h.value,el:s.value})});const c=te(),a=S(()=>e.optionsEl.value.findIndex(l=>l.key==h.value));pe(()=>{e==null||e.optionsEl.value.splice(a.value,1)});const d=S(()=>e.model.value.includes(e.field.value.keyValue?t.value[e.field.value.keyValue]:t.value)),p=S(()=>{const l=e.field.value.keyValue,r=e.filteredOptions.value[e.focusOption.value];let f=!1;return r&&(f=(l?t.value[l]:t.value)==(l?r[l]:r)),f});return()=>R("div",{ref:s,id:`${e.id}-option-${c}`,role:"option","aria-disabled":!1,tabindex:-1,"aria-selected":d.value===!0?d.value:void 0,onFocus:()=>{console.log("LMultiSelectOption: onFocus")},onKeydown:l=>{var r,f;l.key==="Enter"&&(e.onChooseOption(t.value),e.field.value.multiple||(e.show.value=!1,e.searchEl.value?(r=e.searchEl.value)==null||r.focus():(f=e.selectButtonEl.value)==null||f.focus({preventScroll:!0}),l.preventDefault()))},onMouseenter:l=>{console.log("LMultiSelectOption: onMouseenter"),e.focusOption.value=a.value,l.shiftKey?e.indexShiftTo.value=e.focusOption.value-1:e.indexShiftFrom.value=e.focusOption.value},onMouseleave:l=>{console.log("LMultiSelectOption: onMouseleave"),e.focusOption.value=null,l.shiftKey||(e.indexShiftFrom.value=0)},onClick:W(l=>{console.log("LMultiSelectOption: onClick"),l.shiftKey?e.chooseItemsOfRange({range:{from:e.indexShiftFrom.value,to:e.indexShiftTo.value}}):(e==null||e.onChooseOption(t.value),e.field.value.multiple||(e.selectButtonEl.value.focus({preventScroll:!0}),e.show.value=!1,l.preventDefault()),N(()=>{var r;e!=null&&e.searchEl.value&&((r=e==null?void 0:e.searchEl.value)==null||r.focus(),l.preventDefault())}))},["stop"])},v.default?v.default({optionId:c,selected:d.value,hovered:p.value,focused:e==null?void 0:e.focusOption.value}):[])}}),Ie={class:"flex-auto flex flex-wrap m-1"},Ce={class:"m-0.5 rounded-md py-1 leading-5 bg-s-200 dark:bg-s-600 flex items-center"},$e={class:"block flex-auto px-1"},Be={key:1,class:"p-1 text-s-500 dark:text-s-400"},Te={class:"py-2 pr-2"},Ae={class:"absolute right-8 top-0 h-full flex items-center"},De={key:0,class:"p-2"},Ke={class:"shadow-inner overflow-hidden max-h-64 b-scroll overflow-y-auto"},qe={key:0,class:"flex p-2 font-bold cursor-pointer bg-s-100"},je={class:D(["flex items-center border rounded-md h-6 w-6 mr-2 border-s-200 dark:border-s-700 text-xl text-p-500"])},Ne=C({name:"FMultiSelect",inheritAttrs:!1}),Re=C({...Ne,props:{modelValue:null,error:null,field:null,required:{type:Boolean}},emits:["update:modelValue","on-input","on-load-items"],setup(t,{emit:v}){const e=t,s=S({get(){return e.modelValue},set(l){v("update:modelValue",l)}}),h=S(()=>{let l=!0;switch(typeof s.value){case"string":l=s.value=="";break;case"number":l=s.value==0;break;default:Array.isArray(s.value)&&(l=s.value.length==0);break}return l}),c=y(null),a=O(()=>{var r;const l=(r=c.value)==null?void 0:r.$el;l&&l.click()},"onSetFocus"),d=O(async()=>{let l=0;switch(typeof s.value){case"string":l="";break;default:l=[];break}s.value=l,await v("on-input"),await a()},"onReset"),p=y(!1);return(l,r)=>{const f=he("ripple");return w(),T(P,null,[A(l.$slots,"label",{id:t.field.id,required:t.required,onSetFocus:a}),V("div",{class:D(["flex items-center",["rounded-md border text-base transition w-full appearance-none outline-none focus-within:ring-1 hover:ring-1  bg-white dark:bg-s-900",{"border-d-500 dark:border-d-500 focus-within:ring-d-500 focus-within:border-d-500 hover:ring-d-500":t.error},(p.value,""),{"border-s-200 dark:border-s-600 focus-within:ring-p-500 focus-within:border-p-500  hover:ring-p-500 hover:border-p-500":!t.error}]])},[A(l.$slots,"before"),ee(k(Se),ge(l.$attrs,{modelValue:k(s),"onUpdate:modelValue":r[0]||(r[0]=b=>ye(s)?s.value=b:null),showList:p.value,"onUpdate:showList":r[1]||(r[1]=b=>p.value=b),field:t.field,error:t.error,class:"relative flex-auto",onOnLoadItems:r[2]||(r[2]=b=>l.$emit("on-load-items")),onOnInput:r[3]||(r[3]=b=>l.$emit("on-input"))}),{default:F(({select:b,show:K,loading:Q,disabled:X,selectedOptions:q})=>[ee(k(xe),{ref_key:"inputElement",ref:c,class:D(["outline-none flex space-x-2 items-center w-full transition"])},{default:F(()=>[V("div",Ie,[(w(!0),T(P,null,le(q,L=>(w(),M(k(Le),{key:L.name},{default:F(({removeOption:E})=>[A(l.$slots,"selected-item",{option:L,removeOption:E},()=>[V("div",Ce,[V("span",$e,I(t.field.keyLabel?L[t.field.keyLabel]:L),1)])])]),_:2},1024))),128)),t.field.keyFilter&&(!q.length&&!t.field.multiple||t.field.multiple)?(w(),M(k(Ee),{key:0,class:"px-2 py-1 cursor-text outline-none bg-transparent placeholder-s-400"})):j("",!0),!t.field.keyFilter&&!q.length?(w(),T("div",Be,I(t.field.placeholder),1)):j("",!0)]),V("div",Te,[Q?(w(),M(k(Oe),{key:0})):(w(),M(k(_),{key:1,class:D(["transition-transform",{"rotate-180":K}])},{default:F(()=>[U(I(k(ke)),1)]),_:2},1032,["class"]))])]),_:2},1536),V("div",Ae,[A(l.$slots,"after",{onReset:d,empty:k(h)})]),V("div",{class:D(["z-10 mt-1.5 transition overflow-hidden shadow-2xl outline-none border border-s-200 dark:border-s-700 rounded-md absolute top-full left-0 right-0 bg-white dark:bg-s-800",[K?"block":"hidden",(t.error,""),{"border-d-500 dark:border-d-500 focus-within:ring-d-500 focus-within:border-d-500":t.error},(p.value,""),{"border-s-200 dark:border-s-600 focus-within:ring-p-500 focus-within:border-p-500":!t.error}]])},[t.error?(w(),T("div",De,[A(l.$slots,"error",{error:t.error})])):j("",!0),V("div",Ke,[ee(k(Ve),null,{default:F(({groups:L})=>[(w(!0),T(P,null,le(L,E=>(w(),M(k(Fe),{key:E.key,group:E.key},{default:F(({options:J,groupSelectedOption:H,groupLength:x})=>[E.key!=="default"?(w(),T("div",qe,[V("div",je,[H==x?(w(),M(k(_),{key:0},{default:F(()=>[U(I(k(ne)),1)]),_:1})):j("",!0),H<x&&H!=0?(w(),M(k(_),{key:1},{default:F(()=>[U(I(k(we)),1)]),_:1})):j("",!0)]),U(" "+I(E.key),1)])):j("",!0),(w(!0),T(P,null,le(J,($,Y)=>(w(),M(k(Me),{key:$[t.field.keyValue]||$,value:$,class:"group relative overflow-hidden"},{default:F(({selected:B,focused:oe,hovered:Z})=>[A(l.$slots,"option",{option:$,selected:B},()=>[be((w(),T("div",{class:D(["flex p-2 items-center cursor-pointer focus:outline-none",Z?"bg-p-200 dark:bg-p-800 text-black dark:text-white group-focus:bg-p-200 group-hover:bg-p-200 dark:group-hover:bg-p-800 dark:group-focus:bg-p-800":"bg-transparent text-black dark:text-white group-focus:bg-p-100 group-hover:bg-p-100 dark:group-hover:bg-p-900 dark:group-focus:bg-p-900"])},[V("div",{class:D(["flex items-center border rounded-md h-6 w-6 mr-2",B||Z?"border-transparent":"border-s-200 dark:border-s-700"])},[B?(w(),M(k(_),{key:0,class:D(["text-xl",{"text-p-500 dark:text-p-500":B}])},{default:F(()=>[U(I(k(ne)),1)]),_:2},1032,["class"])):j("",!0)],2),U(I(t.field.keyLabel?$[t.field.keyLabel]:$),1)],2)),[[f,{}]])])]),_:2},1032,["value"]))),128))]),_:2},1032,["group"]))),128))]),_:3})])],2),V("pre",null,"        "+I(b.focusOption)+`
      `,1)]),_:3},16,["modelValue","showList","field","error"])],2),A(l.$slots,"error",{error:t.error}),A(l.$slots,"description")],64)}}});Re.__docgenInfo={exportName:"default",displayName:"FMultiSelect",description:"",tags:{},props:[{name:"modelValue",description:"modelValue - model string",required:!0,type:{name:"ISelectModel"}},{name:"error",required:!1,type:{name:"string"}},{name:"field",description:"Schema for field.",required:!0,type:{name:"IField"}},{name:"required",required:!1,type:{name:"boolean"}}],events:[{name:"on-load-items"},{name:"on-input"},{name:"update:modelValue"}],slots:[{name:"label",scoped:!0,bindings:[{name:"id",title:"binding"},{name:"required",title:"binding"},{name:"onSetFocus",title:"binding"}]},{name:"before"},{name:"selected-item",scoped:!0,bindings:[{name:"option",title:"binding"},{name:"removeOption",title:"binding"}]},{name:"after",scoped:!0,bindings:[{name:"on-reset",title:"binding"},{name:"empty",title:"binding"}]},{name:"error",scoped:!0,bindings:[{name:"error",title:"binding"}]},{name:"option",scoped:!0,bindings:[{name:"option",title:"binding"},{name:"selected",title:"binding"}]},{name:"description"}]};export{Re as _};
//# sourceMappingURL=FMultiSelect.fd937d66.js.map
