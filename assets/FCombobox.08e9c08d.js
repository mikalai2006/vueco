var de=Object.defineProperty;var y=(o,p)=>de(o,"name",{value:p,configurable:!0});import{d as A,a as I,r as f,k as ae,l as se,n as V,h as U,p as S,q as fe,t as pe,v as G,b as ve,o as O,x as B,i as F,g as N,y as Y,f as $,m as be,u as m,z as me,A as E,F as M,e as R,B as D,C as oe,D as te,j as Z,w as le,E as ge}from"./vue.esm-bundler.a08ba302.js";import{u as xe,i as he,a as ye}from"./useIcon.1f824c76.js";import{b as Oe}from"./LForm.e3c9163c.js";import{L as ne}from"./LIcon.ca56402e.js";const ke=y(o=>o.length===1&&o.match(/\S| /),"isPrintableCharacter"),q=Symbol("ComboboxContext"),Ce=A({props:{modelValue:{type:[Array,String,Number],default:()=>[]},field:{type:Object,required:!0,default:()=>({})},error:{type:String,default:""},showList:{type:Boolean,default:!1}},emits:["update:showList","update:modelValue","onLoadItems","on-input"],setup(o,{slots:p,emit:e}){const u=I(()=>{var a;return((a=o.field)==null?void 0:a.autocomplete)||"none"}),c=f(!1),v=f(!1),t=f(!1),l=f(o.field),k=f(-1),s=I(()=>W.value.length>0),d=f(null),g=f(!1),b=f(!1),x=f(!1),J=I(()=>{var a;return((a=l.value)==null?void 0:a.disabled)||x.value||!1}),T=f(!1),K=f(!1),w=f(null),P=f(null),Q=f([]),ie=I({get(){return o.field.multiple&&Array.isArray(o.modelValue)?[...o.modelValue]:[o.modelValue]},set(a){const r=l.value.multiple?a:a[0];e("update:modelValue",r),e("on-input")}}),j=f(""),ue=f(""),W=f([]),X=y(a=>{console.time("onFilterOptions"),typeof a!="boolean"&&(a=!1);const r=j.value.toLowerCase();let i=[];const C=l.value.keyFilter,L=l.value.items||[];return console.log("filter value=",j.value),(c.value||j.value.length===0)&&!a?i=L:C&&(i=L.filter(h=>typeof h=="object"?h[C].toLowerCase().indexOf(r)===0:typeof h=="number"?h!==-1:h.toLowerCase().indexOf(r)===0).sort((h,z)=>n.model.value.indexOf(h[C])-n.model.value.indexOf(z[C]))),W.value=i,console.timeEnd("onFilterOptions"),i},"onFilterOptions");if(ae(()=>o.field.items,()=>{X()}),l.value.autocomplete)if(typeof l.value.autocomplete=="string"){const a=l.value.autocomplete.toLowerCase();c.value=a==="none",v.value=a==="list",t.value=a==="both"}else c.value=!0;const re=y(()=>{console.log("===open"),g.value=!0,setTimeout(()=>{ee()},10),V(()=>{var a;n.isNone.value||(a=w.value)==null||a.setSelectionRange(0,n.filter.value.length)})},"open"),H=y((a,r)=>{var C,L;if(typeof r!="boolean"&&(r=!1),!a)return;const i=a.target;(r||!((C=n.listboxNode.value)!=null&&C.contains(i))&&n.comboboxNode.value!=i)&&(console.log("===close: force=",r),_(),g.value=!1,(L=w.value)==null||L.focus(),n.focusOption.value=-1,l.value.multiple||V(()=>{var h;n.isNone.value||(h=w.value)==null||h.setSelectionRange(n.filter.value.length,n.filter.value.length)}))},"close"),_=y(()=>{document&&(document.removeEventListener("click",H),document.removeEventListener("keyup",H)),console.log("unRegisterOverlay")},"unRegisterOverlay"),ee=y(()=>{document&&(document.addEventListener("click",H),document.addEventListener("keyup",H)),console.log("registerOverlay")},"registerOverlay"),n={autocomplete:u,isNone:c,isBoth:t,isList:v,field:l,comboboxNode:w,listboxNode:P,focusOption:k,hasOptions:s,filter:j,filterText:ue,option:d,allOptions:Q,filteredOptions:W,model:ie,comboboxHasVisualFocus:T,listboxHasVisualFocus:K,hasHover:b,isOpen:g,isBusy:x,isDisabled:J,open:re,close:H,registerOverlay:ee,unRegisterOverlay:_,onChangeActiveIndex:y((a,r)=>{let i=n.focusOption.value||0;return r||r===0?i=r:(a.key==="ArrowDown"?i++:a.key==="ArrowUp"&&i--,i>n.allOptions.value.length-1&&(i=n.allOptions.value.length-1),i<0&&(i=0)),console.log("onChangeActiveIndex: newIndex=",i),n.focusOption.value=i,i},"onChangeActiveIndex"),onSetFocusOption:y(()=>{const a=n.field.value.keyValue;V(()=>{var C;const r=n.filteredOptions.value[n.focusOption.value];if(!r)return;const i=n.allOptions.value.find(L=>L.index===(a&&typeof r=="object"?r[a]:r));i!=null&&i.el&&(console.log("elForFocus.el=",i.el),(C=i.el)==null||C.focus())})},"onSetFocusOption"),onChooseOption:y((a,r)=>{typeof r!="boolean"&&(r=!1);const i=n.field.value.keyValue&&typeof a=="object"?a[n.field.value.keyValue]:a,C=n.model.value.findIndex(h=>h===i);let L=[...n.model.value];n.field.value.multiple?(C!==-1?L.splice(C,1):L.push(i),n.filter.value=`${i}`):(L=[i],n.filter.value=`${i}`),c.value||V(()=>{var h,z;r?(h=n.comboboxNode.value)==null||h.setSelectionRange(0,n.filter.value.length):(z=n.comboboxNode.value)==null||z.setSelectionRange(n.filterText.value.length,n.filter.value.length)}),console.log("onChooseOption:",n.model.value,a)},"onChooseOption"),onFilterOptions:X,onSetValue:y(()=>{if(l.value.multiple){const a=[...n.model.value],r=n.model.value.findIndex(i=>i==n.filter.value);r!=-1?a.splice(r,1):a.push(n.filter.value),n.model.value=a,j.value=""}else n.model.value=[n.filter.value];console.groupEnd()},"onSetValue")},ce=y(async()=>{x.value=!0,await e("onLoadItems"),x.value=!1},"loadData");return se(async()=>{await ce(),V(()=>{var a;l.value.autofocus&&((a=n.comboboxNode.value)==null||a.focus())}),await X()}),pe(q,n),()=>U("div",{onClick:S(a=>{var r;console.log("LComboboxInput: onClick"),n.isOpen.value?n.close(a,!0):n.open(),(r=w.value)==null||r.focus()},["stop"])},{default:()=>p.default?p.default({combobox:n,isOpen:g.value,isBusy:x.value}):[]})}}),we=A({name:"LComboboxInput",setup(o,{slots:p}){const e=G(q);if(!e){console.info("LComboboxInput must be nested to LCombobox component");return}const u=f(null),c=y(()=>{e.filterText.value=e.filter.value,e.isBusy.value=!1,e.focusOption.value=-1,!e.isOpen.value&&e.open(),e.onFilterOptions(),V(()=>{if(e.isBoth.value){const t=e.filteredOptions.value[0];t&&e.filterText.value.length&&e.onChooseOption(t)}})},"onSearch");ae(()=>e.model.value,t=>{var l;e.isBoth.value&&!((l=e.field.value)!=null&&l.multiple)&&(e.filter.value=`${t[0]}`)});const v=I(()=>{var l;const t={};return e.allOptions.value[e.focusOption.value]&&(t["aria-activedescendant"]=`${(l=e.allOptions.value[e.focusOption.value])==null?void 0:l.key}`),t});return()=>U("input",{ref:e.comboboxNode,id:e.field.value.id,value:e.filter.value,type:"text",name:e.field.value.id,role:"combobox",tabindex:0,placeholder:e.field.value.placeholder,"aria-autocomplete":e.autocomplete.value,"aria-expanded":e.isOpen.value,"aria-controls":`${e.field.value.name}-listbox`,...v.value,onInput:t=>{const l=t.target;u.value&&clearTimeout(u.value),e.isBusy.value=!0,e.filter.value=l.value,u.value=setTimeout(()=>c(),500)},onClick:S(t=>{console.log("LComboboxInput: onClick"),e.isOpen.value?e.close(t,!0):e.open()},["stop"]),onKeydown:S(t=>{var s,d,g;console.log("LComboboxInput: onKeydown",t.keyCode,t.key);let l=!1;const k=t.altKey;switch(t.key){case"Enter":if(console.log("LComboboxInput: press Enter"),e.isOpen.value&&e.focusOption.value!=-1){const b=e.filteredOptions.value[e.focusOption.value];b&&(e.onChooseOption(b,!0),e.onSetValue()),e.field.value.multiple||(e.close(t,!0),e.onFilterOptions(!0))}e.filterText.value="",l=!0;break;case"ArrowDown":case"Down":if(console.log("LComboboxInput: press ArrowDown, Down"),e.hasOptions)if(k)!e.isOpen.value&&e.open();else{!e.isOpen.value&&e.open(),e.onChangeActiveIndex(t);const b=e.filteredOptions.value[e.focusOption.value];b&&e.isBoth.value&&e.onChooseOption(b,!0),e.onSetFocusOption(),V(()=>{var x;(x=e.comboboxNode.value)==null||x.focus(),e.filterText.value=""})}l=!0;break;case"Up":case"ArrowUp":if(console.log("LComboboxInput: press Up, ArrowUp"),e.hasOptions)if(k)e.open();else{e.isOpen.value?e.onChangeActiveIndex(t):(e.open(),e.onChangeActiveIndex(t,e.filteredOptions.value.length-1)),e.onSetFocusOption();const b=e.filteredOptions.value[e.focusOption.value];b&&e.isBoth.value&&e.onChooseOption(b),V(()=>{var x;(x=e.comboboxNode.value)==null||x.focus(),e.filterText.value=""})}l=!0;break;case"Esc":case"Escape":console.log("LComboboxInput: press Esc, Escape"),e.isOpen.value?(e.close(t,!0),(s=e.comboboxNode.value)==null||s.setSelectionRange(e.filter.value.length,e.filter.value.length)):(e.model.value=[],e.filter.value="",e.filterText.value=""),e.onFilterOptions(!0),l=!0;break;case"Tab":console.log("LComboboxInput: press Tab"),e.close(t,!0);break;case"Home":console.log("LComboboxInput: press Home"),(d=e.comboboxNode.value)==null||d.setSelectionRange(0,0),l=!0;break;case"End":console.log("LComboboxInput: press End"),(g=e.comboboxNode.value)==null||g.setSelectionRange(e.filter.value.length,e.filter.value.length),l=!0;break}l&&(t.stopPropagation(),t.preventDefault())},[]),onKeyup:S(t=>{console.log("LComboboxInput: onKeyup, ",t.key);let l=!1;const k=t.key;if(!(t.key==="Escape"||t.key==="Esc")){switch(t.key){case"Backspace":console.log("LComboboxInput: onKeyup: Backspace"),e.onFilterOptions(),l=!0;break;case"Left":case"ArrowLeft":case"Right":case"ArrowRight":case"Home":case"End":console.log("LComboboxInput: onKeyup: Left or other"),e.isBoth.value;break;default:ke(k)&&(l=!0);break}l&&(t.stopPropagation(),t.preventDefault())}},[]),onFocus:()=>{console.log("LComboboxInput: onFocus")},onBlur:()=>{console.log("LComboboxInput: onBlur")}},p.default?p.default({}):[])}}),Le=A({name:"LComboboxButton",setup(o,{slots:p}){const e=G(q);if(!e){console.info("LComboboxButton must be nested to LCombobox component");return}return()=>{var u;return U("div",{ref:e.comboboxNode,id:e.field.value.id,name:e.field.value.id,role:"combobox",tabindex:0,"aria-labelledby":`${e.field.value.id}_label`,"aria-expanded":e.isOpen.value,"aria-controls":`${e.field.value.name}-listbox`,"aria-activedescendant":`${((u=e.allOptions.value[e.focusOption.value])==null?void 0:u.key)||""}`,onClick:S(c=>{console.log("LComboboxButton: onClick"),e.isOpen.value?e.close(c,!0):e.open()},[]),onKeydown:S(c=>{console.log("LComboboxButton: onKeydown");let v=!1;const t=c.altKey;switch(c.key){case"Enter":if(console.log("LComboboxButton: press Enter"),e.isOpen.value&&e.focusOption.value!=-1){const l=e.filteredOptions.value[e.focusOption.value];l&&(e.onChooseOption(l,!0),e.onSetValue()),e.field.value.multiple||e.close(c,!0)}v=!0;break;case"ArrowDown":case"Down":console.log("LComboboxButton: press ArrowDown, Down"),e.hasOptions&&(t?!e.isOpen.value&&e.open():(e.isOpen.value?e.onChangeActiveIndex(c):(e.open(),e.focusOption.value<=0&&(e.focusOption.value=0),e.onChangeActiveIndex(c,e.focusOption.value)),e.onSetFocusOption(),V(()=>{var l;(l=e.comboboxNode.value)==null||l.focus()}))),v=!0;break;case"Up":case"ArrowUp":console.log("LComboboxButton: press Up, ArrowUp"),e.hasOptions&&(t?e.open():(e.isOpen.value?e.onChangeActiveIndex(c):(e.open(),e.focusOption.value<=0&&(e.focusOption.value=e.filteredOptions.value.length-1),e.onChangeActiveIndex(c,e.focusOption.value)),e.onSetFocusOption(),V(()=>{var l;(l=e.comboboxNode.value)==null||l.focus(),e.filterText.value=""}))),v=!0;break;case"Esc":case"Escape":console.log("LComboboxButton: press Esc, Escape"),e.isOpen.value?e.close(c,!0):(e.model.value=[],e.filter.value="",e.filterText.value=""),v=!0;break;case"Tab":console.log("LComboboxButton: press Tab"),e.close(c,!0);break;case"Home":console.log("LComboboxButton: press Home"),v=!0;break;case"End":console.log("LComboboxButton: press End"),v=!0;break}v&&(c.stopPropagation(),c.preventDefault())},[])},p.default?p.default({}):[])}}}),Ve=A({name:"LComboboxOptions",props:{as:{type:String,default:"ul"}},setup(o,{slots:p}){const e=G(q);if(!e){console.info("LComboboxOptions must be nested to LCombobox component");return}return()=>U(o.as,{ref:e.listboxNode,id:`${e.field.value.id}-listbox`,role:"listbox","aria-labelledby":`${e.field.value.id}`,onKeydown:S(u=>{console.log("LComboboxOptions: onKeyDown",u.key)},["stop"]),onPointerup:()=>{console.log("LComboboxOptions: onPointerup")},onPointerover:()=>{console.log("LComboboxOptions: onPointerover"),e.hasHover.value=!0},onPointerout:()=>{console.log("LComboboxOptions: onPointerout"),e.hasHover.value=!1}},p.default?p.default({options:e.filteredOptions.value,hasOptions:e.hasOptions.value}):[])}}),Ie=A({props:{as:{type:String,default:"li"},value:{type:[String,Number,Object],default:""}},name:"LComboboxOption",setup(o,{slots:p}){const e=G(q);if(!e){console.info("LComboboxOption must be nested to LComboboxOptions component");return}const u=f(null),c=xe(),v=I(()=>e.field.value.keyValue&&typeof o.value=="object"?o.value[e.field.value.keyValue]:o.value),t=I(()=>e.model.value.includes(e.field.value.keyValue&&typeof o.value=="object"?o.value[e.field.value.keyValue]:o.value)),l=I(()=>{const s=e.field.value.keyValue,d=e.filteredOptions.value[e.focusOption.value];let g=!1;return d&&(g=(s&&typeof o.value=="object"?o.value[s]:o.value)==(s&&typeof d=="object"?d[s]:d)),g});se(()=>{e.allOptions.value.push({index:v.value,key:`${e.field.value.id}-option-${c}`,el:u.value})});const k=I(()=>e==null?void 0:e.allOptions.value.findIndex(s=>s.key==v.value));return fe(()=>{e==null||e.allOptions.value.splice(k.value,1)}),()=>U(o.as,{ref:u,id:`${e.field.value.id}-option-${c}`,role:"option","aria-disabled":!1,tabindex:-1,"aria-selected":t.value===!0?t.value:void 0,onKeydown:S(s=>{console.log("LComboboxOption: onKeyDown",s.key)},["stop"]),onPointerup:()=>{console.log("LComboboxOption: onPointerup")},onPointerover:()=>{console.log("LComboboxOption: onPointerover"),e.hasHover.value=!0},onPointerout:()=>{console.log("LComboboxOption: onPointerout"),e.hasHover.value=!1},onClick:S(s=>{var d;e.onChooseOption(o.value),e.onSetValue(),(d=e.field.value)!=null&&d.multiple||e.close(s,!0),e.isNone||e.onFilterOptions(!0),V(()=>{var g;(g=e.comboboxNode.value)==null||g.focus()})},["stop"])},p.default?p.default({selected:t.value,hovered:l.value}):e.field.value.keyValue&&typeof o.value=="object"?o.value[e.field.value.keyValue]:o.value)}}),Be={class:E(["outline-none flex space-x-2 items-center w-full transition"])},Se={class:"flex-auto flex flex-wrap m-1"},Ne={key:0},Ee={key:1,class:"text-s-400"},Ae={key:0,class:"flex flex-row flex-wrap"},Fe={class:"py-2 pr-2"},$e={class:"absolute right-8 top-0 h-full flex items-center"},De={class:E(["flex items-center h-6 w-6 mr-2"])},Te={key:1,class:"p-2"},Ke=A({name:"FCombobox",inheritAttrs:!1}),Pe=A({...Ke,props:{modelValue:null,error:null,field:null,required:{type:Boolean}},emits:["update:modelValue","on-input","on-load-items"],setup(o,{emit:p}){const e=o,u=I({get(){return e.modelValue},set(s){p("update:modelValue",s)}}),c=I(()=>{let s=!0;switch(typeof u.value){case"string":s=u.value=="";break;case"number":s=u.value==0;break;default:Array.isArray(u.value)&&(s=u.value.length==0);break}return s}),v=f(null),t=y(()=>{var d;const s=(d=v.value)==null?void 0:d.$el;s&&s.focus()},"onSetFocus"),l=y(async()=>{let s=0;switch(typeof u.value){case"string":s="";break;default:s=[];break}u.value=s,await p("on-input"),await t()},"onReset"),k=f(!1);return(s,d)=>{const g=ve("ripple");return O(),B(M,null,[F(s.$slots,"label",{id:o.field.id,required:o.required,onSetFocus:t}),N("div",{class:E(["flex items-center cursor-pointer",["rounded-md border text-base transition w-full appearance-none outline-none focus-within:ring-1 hover:ring-1  bg-white dark:bg-s-900",{"border-d-500 dark:border-d-500 focus-within:ring-d-500 focus-within:border-d-500 hover:ring-d-500":o.error},(k.value,""),{"border-s-200 dark:border-s-600 focus-within:ring-p-500 focus-within:border-p-500 hover:ring-p-500 hover:border-p-500":!o.error}]])},[F(s.$slots,"before"),Y(m(Ce),be(s.$attrs,{modelValue:m(u),"onUpdate:modelValue":d[0]||(d[0]=b=>me(u)?u.value=b:null),showList:k.value,"onUpdate:showList":d[1]||(d[1]=b=>k.value=b),field:o.field,error:o.error,class:"relative flex-auto",onOnLoadItems:d[2]||(d[2]=b=>s.$emit("on-load-items")),onOnInput:d[3]||(d[3]=b=>s.$emit("on-input"))}),{default:$(({combobox:b,isOpen:x,isBusy:J})=>[N("div",Be,[N("div",Se,[b.isNone.value?(O(),R(m(Le),{key:0,ref_key:"inputElement",ref:v,autocomplete:"off",class:"w-full px-2 py-1 outline-none bg-transparent"},{default:$(()=>[m(u)?(O(),B("div",Ne,D(m(u)),1)):(O(),B("div",Ee,D(o.field.placeholder),1))]),_:1},512)):(O(),B(M,{key:1},[typeof m(u)=="object"&&o.field.multiple?(O(),B("div",Ae,[(O(!0),B(M,null,oe(m(u),(T,K)=>(O(),B("div",{key:K,class:"px-2 bg-s-300 dark:bg-s-700 rounded-md mr-1 mb-1"},D(T),1))),128))])):te("",!0),Y(m(we),{ref_key:"inputElement",ref:v,autocomplete:"off",class:"w-full px-2 py-1 cursor-text outline-none bg-transparent placeholder-s-400"},null,512)],64))]),N("div",Fe,[J?(O(),R(m(Oe),{key:0})):(O(),R(m(ne),{key:1,class:E(["transition-transform",{"rotate-180":x}])},{default:$(()=>[Z(D(m(he)),1)]),_:2},1032,["class"]))]),N("div",$e,[F(s.$slots,"after",{onReset:l,empty:m(c)})])]),le(N("div",{class:E(["z-10 mt-1.5 transition overflow-hidden shadow-2xl outline-none border border-s-200 dark:border-s-700 rounded-md absolute top-full left-0 right-0 bg-white dark:bg-s-800",[x?"block":"hidden",(o.error,""),{"border-d-500 dark:border-d-500 focus-within:ring-d-500 focus-within:border-d-500":o.error},(k.value,""),{"border-s-200 dark:border-s-600 focus-within:ring-p-500 focus-within:border-p-500":!o.error}]])},[Y(m(Ve),{class:"max-h-64 b-scroll overflow-y-auto"},{default:$(({options:T,hasOptions:K})=>[K?(O(!0),B(M,{key:0},oe(T,w=>(O(),R(m(Ie),{key:o.field.keyValue?w[o.field.keyValue]:w,value:w,class:"group relative overflow-hidden"},{default:$(({selected:P,hovered:Q})=>[F(s.$slots,"option",{option:w,selected:P},()=>[le((O(),B("div",{class:E(["flex p-2 items-center cursor-pointer focus:outline-none",Q?"bg-p-200 dark:bg-p-800 text-black dark:text-white group-focus:bg-p-200 group-hover:bg-p-200 dark:group-hover:bg-p-800 dark:group-focus:bg-p-800":"bg-transparent text-black dark:text-white group-focus:bg-p-100 group-hover:bg-p-100 dark:group-hover:bg-p-900 dark:group-focus:bg-p-900"])},[N("div",De,[P?(O(),R(m(ne),{key:0,class:E(["text-xl",{"text-p-500 dark:text-p-500":P}])},{default:$(()=>[Z(D(m(ye)),1)]),_:2},1032,["class"])):te("",!0)]),Z(" "+D(o.field.keyLabel?w[o.field.keyLabel]:w),1)],2)),[[g,{}]])])]),_:2},1032,["value"]))),128)):(O(),B("div",Te,"None options"))]),_:3})],2),[[ge,x]])]),_:3},16,["modelValue","showList","field","error"])],2),F(s.$slots,"error",{error:o.error}),F(s.$slots,"description")],64)}}});Pe.__docgenInfo={exportName:"default",displayName:"FCombobox",description:"",tags:{},props:[{name:"modelValue",description:"modelValue - model string",required:!0,type:{name:"TComboboxModel"}},{name:"error",required:!1,type:{name:"string"}},{name:"field",description:"Schema for field.",required:!0,type:{name:"IField"}},{name:"required",required:!1,type:{name:"boolean"}}],events:[{name:"on-load-items"},{name:"on-input"},{name:"update:modelValue"}],slots:[{name:"label",scoped:!0,bindings:[{name:"id",title:"binding"},{name:"required",title:"binding"},{name:"onSetFocus",title:"binding"}]},{name:"before"},{name:"after",scoped:!0,bindings:[{name:"on-reset",title:"binding"},{name:"empty",title:"binding"}]},{name:"option",scoped:!0,bindings:[{name:"option",title:"binding"},{name:"selected",title:"binding"}]},{name:"error",scoped:!0,bindings:[{name:"error",title:"binding"}]},{name:"description"}]};export{Pe as _};
//# sourceMappingURL=FCombobox.08e9c08d.js.map
