var de=Object.defineProperty;var y=(o,v)=>de(o,"name",{value:v,configurable:!0});import{d as A,a as S,r as p,f as ae,o as se,n as V,h as U,g as B,i as fe,p as pe,j as G,b as ve,k as O,l as I,m as F,q as N,t as Y,u as $,v as be,x as m,y as me,z as E,F as M,A as R,B as D,C as oe,D as te,E as Z,w as le,G as ge}from"./vue.esm-bundler.d6e8a8ce.js";import{u as xe,i as he,a as ye}from"./useIcon.1f824c76.js";import{L as Oe}from"./LSpinner.c9659ed3.js";import{L as ne}from"./LIcon.b157f1df.js";const ke=y(o=>o.length===1&&o.match(/\S| /),"isPrintableCharacter"),q=Symbol("ComboboxContext"),Ce=A({props:{modelValue:{type:[Array,String,Number],default:()=>[]},field:{type:Object,required:!0,default:()=>({})},error:{type:String,default:""}},emits:["update:showList","update:modelValue","onLoadItems","on-input"],setup(o,{slots:v,emit:e}){const u=S(()=>{var l;return((l=o.field)==null?void 0:l.autocomplete)||"none"}),c=p(!1),d=p(!1),n=p(!1),s=p(o.field),k=p(-1),a=S(()=>W.value.length>0),f=p(null),g=p(!1),b=p(!1),x=p(!1),J=S(()=>{var l;return((l=s.value)==null?void 0:l.disabled)||x.value||!1}),T=p(!1),K=p(!1),w=p(null),P=p(null),Q=p([]),ie=S({get(){return o.field.multiple&&Array.isArray(o.modelValue)?[...o.modelValue]:[o.modelValue]},set(l){const r=s.value.multiple?l:l[0];e("update:modelValue",r),e("on-input")}}),j=p(""),ue=p(""),W=p([]),X=y(l=>{console.time("onFilterOptions"),typeof l!="boolean"&&(l=!1);const r=j.value.toLowerCase();let i=[];const C=s.value.keyFilter,L=s.value.items||[];return console.log("filter value=",j.value),(c.value||j.value.length===0)&&!l?i=L:C&&(i=L.filter(h=>typeof h=="object"?h[C].toLowerCase().indexOf(r)===0:typeof h=="number"?h!==-1:h.toLowerCase().indexOf(r)===0).sort((h,z)=>t.model.value.indexOf(h[C])-t.model.value.indexOf(z[C]))),W.value=i,console.timeEnd("onFilterOptions"),i},"onFilterOptions");if(ae(()=>o.field.items,()=>{X()}),s.value.autocomplete)if(typeof s.value.autocomplete=="string"){const l=s.value.autocomplete.toLowerCase();c.value=l==="none",d.value=l==="list",n.value=l==="both"}else c.value=!0;const re=y(()=>{console.log("===open"),g.value=!0,setTimeout(()=>{ee()},10),V(()=>{var l;t.isNone.value||(l=w.value)==null||l.setSelectionRange(0,t.filter.value.length)})},"open"),H=y((l,r)=>{var C,L;if(typeof r!="boolean"&&(r=!1),!l)return;const i=l.target;(r||!((C=t.listboxNode.value)!=null&&C.contains(i))&&t.comboboxNode.value!=i)&&(console.log("===close: force=",r),_(),g.value=!1,(L=w.value)==null||L.focus(),t.focusOption.value=-1,s.value.multiple||V(()=>{var h;t.isNone.value||(h=w.value)==null||h.setSelectionRange(t.filter.value.length,t.filter.value.length)}))},"close"),_=y(()=>{document&&(document.removeEventListener("click",H),document.removeEventListener("keyup",H)),console.log("unRegisterOverlay")},"unRegisterOverlay"),ee=y(()=>{document&&(document.addEventListener("click",H),document.addEventListener("keyup",H)),console.log("registerOverlay")},"registerOverlay"),t={autocomplete:u,isNone:c,isBoth:n,isList:d,field:s,comboboxNode:w,listboxNode:P,focusOption:k,hasOptions:a,filter:j,filterText:ue,option:f,allOptions:Q,filteredOptions:W,model:ie,comboboxHasVisualFocus:T,listboxHasVisualFocus:K,hasHover:b,isOpen:g,isBusy:x,isDisabled:J,open:re,close:H,registerOverlay:ee,unRegisterOverlay:_,onChangeActiveIndex:y((l,r)=>{let i=t.focusOption.value||0;return r||r===0?i=r:(l.key==="ArrowDown"?i++:l.key==="ArrowUp"&&i--,i>t.allOptions.value.length-1&&(i=t.allOptions.value.length-1),i<0&&(i=0)),console.log("onChangeActiveIndex: newIndex=",i),t.focusOption.value=i,i},"onChangeActiveIndex"),onSetFocusOption:y(()=>{const l=t.field.value.keyValue;V(()=>{var C;const r=t.filteredOptions.value[t.focusOption.value];if(!r)return;const i=t.allOptions.value.find(L=>L.index===(l&&typeof r=="object"?r[l]:r));i!=null&&i.el&&(console.log("elForFocus.el=",i.el),(C=i.el)==null||C.focus())})},"onSetFocusOption"),onChooseOption:y((l,r)=>{typeof r!="boolean"&&(r=!1);const i=t.field.value.keyValue&&typeof l=="object"?l[t.field.value.keyValue]:l,C=t.model.value.findIndex(h=>h===i);let L=[...t.model.value];t.field.value.multiple?(C!==-1?L.splice(C,1):L.push(i),t.filter.value=`${i}`):(L=[i],t.filter.value=`${i}`),c.value||V(()=>{var h,z;r?(h=t.comboboxNode.value)==null||h.setSelectionRange(0,t.filter.value.length):(z=t.comboboxNode.value)==null||z.setSelectionRange(t.filterText.value.length,t.filter.value.length)}),console.log("onChooseOption:",t.model.value,l)},"onChooseOption"),onFilterOptions:X,onSetValue:y(()=>{if(s.value.multiple){const l=[...t.model.value],r=t.model.value.findIndex(i=>i==t.filter.value);r!=-1?l.splice(r,1):l.push(t.filter.value),t.model.value=l,j.value=""}else t.model.value=[t.filter.value];console.groupEnd()},"onSetValue")},ce=y(async()=>{x.value=!0,await e("onLoadItems"),x.value=!1},"loadData");return se(async()=>{await ce(),V(()=>{var l;s.value.autofocus&&((l=t.comboboxNode.value)==null||l.focus())}),await X()}),pe(q,t),()=>U("div",{onClick:B(l=>{var r;console.log("LComboboxInput: onClick"),t.isOpen.value?t.close(l,!0):t.open(),(r=w.value)==null||r.focus()},["stop"])},{default:()=>v.default?v.default({combobox:t,isOpen:g.value,isBusy:x.value}):[]})}}),we=A({name:"LComboboxInput",setup(o,{slots:v}){const e=G(q);if(!e){console.info("LComboboxInput must be nested to LCombobox component");return}const u=p(null),c=y(()=>{e.filterText.value=e.filter.value,e.isBusy.value=!1,e.focusOption.value=-1,!e.isOpen.value&&e.open(),e.onFilterOptions(),V(()=>{if(e.isBoth.value){const d=e.filteredOptions.value[0];d&&e.filterText.value.length&&e.onChooseOption(d)}})},"onSearch");return ae(()=>e.model.value,d=>{var n;e.isBoth.value&&!((n=e.field.value)!=null&&n.multiple)&&(e.filter.value=`${d[0]}`)}),()=>{var d;return U("input",{ref:e.comboboxNode,id:e.field.value.id,value:e.filter.value,type:"text",name:e.field.value.id,role:"combobox",tabindex:0,placeholder:e.field.value.placeholder,"aria-autocomplete":e.autocomplete.value,"aria-expanded":e.isOpen.value,"aria-controls":`${e.field.value.name}-listbox`,"aria-activedescendant":`${((d=e.allOptions.value[e.focusOption.value])==null?void 0:d.key)||""}`,onInput:n=>{const s=n.target;u.value&&clearTimeout(u.value),e.isBusy.value=!0,e.filter.value=s.value,u.value=setTimeout(()=>c(),500)},onClick:B(n=>{console.log("LComboboxInput: onClick"),e.isOpen.value?e.close(n,!0):e.open()},["stop"]),onKeydown:B(n=>{var a,f,g;console.log("LComboboxInput: onKeydown",n.keyCode,n.key);let s=!1;const k=n.altKey;switch(n.key){case"Enter":if(console.log("LComboboxInput: press Enter"),e.isOpen.value&&e.focusOption.value!=-1){const b=e.filteredOptions.value[e.focusOption.value];b&&(e.onChooseOption(b,!0),e.onSetValue()),e.field.value.multiple||(e.close(n,!0),e.onFilterOptions(!0))}e.filterText.value="",s=!0;break;case"ArrowDown":case"Down":if(console.log("LComboboxInput: press ArrowDown, Down"),e.hasOptions)if(k)!e.isOpen.value&&e.open();else{!e.isOpen.value&&e.open(),e.onChangeActiveIndex(n);const b=e.filteredOptions.value[e.focusOption.value];b&&e.isBoth.value&&e.onChooseOption(b,!0),e.onSetFocusOption(),V(()=>{var x;(x=e.comboboxNode.value)==null||x.focus(),e.filterText.value=""})}s=!0;break;case"Up":case"ArrowUp":if(console.log("LComboboxInput: press Up, ArrowUp"),e.hasOptions)if(k)e.open();else{e.isOpen.value?e.onChangeActiveIndex(n):(e.open(),e.onChangeActiveIndex(n,e.filteredOptions.value.length-1)),e.onSetFocusOption();const b=e.filteredOptions.value[e.focusOption.value];b&&e.isBoth.value&&e.onChooseOption(b),V(()=>{var x;(x=e.comboboxNode.value)==null||x.focus(),e.filterText.value=""})}s=!0;break;case"Esc":case"Escape":console.log("LComboboxInput: press Esc, Escape"),e.isOpen.value?(e.close(n,!0),(a=e.comboboxNode.value)==null||a.setSelectionRange(e.filter.value.length,e.filter.value.length)):(e.model.value=[],e.filter.value="",e.filterText.value=""),e.onFilterOptions(!0),s=!0;break;case"Tab":console.log("LComboboxInput: press Tab"),e.close(n,!0);break;case"Home":console.log("LComboboxInput: press Home"),(f=e.comboboxNode.value)==null||f.setSelectionRange(0,0),s=!0;break;case"End":console.log("LComboboxInput: press End"),(g=e.comboboxNode.value)==null||g.setSelectionRange(e.filter.value.length,e.filter.value.length),s=!0;break}s&&(n.stopPropagation(),n.preventDefault())},[]),onKeyup:B(n=>{console.log("LComboboxInput: onKeyup, ",n.key);let s=!1;const k=n.key;if(!(n.key==="Escape"||n.key==="Esc")){switch(n.key){case"Backspace":console.log("LComboboxInput: onKeyup: Backspace"),e.onFilterOptions(),s=!0;break;case"Left":case"ArrowLeft":case"Right":case"ArrowRight":case"Home":case"End":console.log("LComboboxInput: onKeyup: Left or other"),e.isBoth.value;break;default:ke(k)&&(s=!0);break}s&&(n.stopPropagation(),n.preventDefault())}},[]),onFocus:()=>{console.log("LComboboxInput: onFocus")},onBlur:()=>{console.log("LComboboxInput: onBlur")}},v.default?v.default({}):[])}}}),Le=A({name:"LComboboxButton",setup(o,{slots:v}){const e=G(q);if(!e){console.info("LComboboxButton must be nested to LCombobox component");return}return()=>{var u;return U("div",{ref:e.comboboxNode,id:e.field.value.id,name:e.field.value.id,role:"combobox",tabindex:0,"aria-labelledby":`${e.field.value.id}_label`,"aria-expanded":e.isOpen.value,"aria-controls":`${e.field.value.name}-listbox`,"aria-activedescendant":`${((u=e.allOptions.value[e.focusOption.value])==null?void 0:u.key)||""}`,onClick:B(c=>{console.log("LComboboxButton: onClick"),e.isOpen.value?e.close(c,!0):e.open()},[]),onKeydown:B(c=>{console.log("LComboboxButton: onKeydown");let d=!1;const n=c.altKey;switch(c.key){case"Enter":if(console.log("LComboboxButton: press Enter"),e.isOpen.value&&e.focusOption.value!=-1){const s=e.filteredOptions.value[e.focusOption.value];s&&(e.onChooseOption(s,!0),e.onSetValue()),e.field.value.multiple||e.close(c,!0)}d=!0;break;case"ArrowDown":case"Down":console.log("LComboboxButton: press ArrowDown, Down"),e.hasOptions&&(n?!e.isOpen.value&&e.open():(e.isOpen.value?e.onChangeActiveIndex(c):(e.open(),e.focusOption.value<=0&&(e.focusOption.value=0),e.onChangeActiveIndex(c,e.focusOption.value)),e.onSetFocusOption(),V(()=>{var s;(s=e.comboboxNode.value)==null||s.focus()}))),d=!0;break;case"Up":case"ArrowUp":console.log("LComboboxButton: press Up, ArrowUp"),e.hasOptions&&(n?e.open():(e.isOpen.value?e.onChangeActiveIndex(c):(e.open(),e.focusOption.value<=0&&(e.focusOption.value=e.filteredOptions.value.length-1),e.onChangeActiveIndex(c,e.focusOption.value)),e.onSetFocusOption(),V(()=>{var s;(s=e.comboboxNode.value)==null||s.focus(),e.filterText.value=""}))),d=!0;break;case"Esc":case"Escape":console.log("LComboboxButton: press Esc, Escape"),e.isOpen.value?e.close(c,!0):(e.model.value=[],e.filter.value="",e.filterText.value=""),d=!0;break;case"Tab":console.log("LComboboxButton: press Tab"),e.close(c,!0);break;case"Home":console.log("LComboboxButton: press Home"),d=!0;break;case"End":console.log("LComboboxButton: press End"),d=!0;break}d&&(c.stopPropagation(),c.preventDefault())},[])},v.default?v.default({}):[])}}}),Ve=A({name:"LComboboxOptions",props:{as:{type:String,default:"ul"}},setup(o,{slots:v}){const e=G(q);if(!e){console.info("LComboboxOptions must be nested to LCombobox component");return}return()=>U(o.as,{ref:e.listboxNode,id:`${e.field.value.id}-listbox`,role:"listbox","aria-labelledby":`${e.field.value.id}-button`,onKeydown:B(u=>{console.log("LComboboxOptions: onKeyDown",u.key)},["stop"]),onPointerup:()=>{console.log("LComboboxOptions: onPointerup")},onPointerover:()=>{console.log("LComboboxOptions: onPointerover"),e.hasHover.value=!0},onPointerout:()=>{console.log("LComboboxOptions: onPointerout"),e.hasHover.value=!1}},v.default?v.default({options:e.filteredOptions.value,hasOptions:e.hasOptions.value}):[])}}),Ie=A({props:{as:{type:String,default:"li"},value:{type:[String,Number,Object],default:""}},name:"LComboboxOption",setup(o,{slots:v}){const e=G(q);if(!e){console.info("LComboboxOption must be nested to LComboboxOptions component");return}const u=p(null),c=xe(),d=S(()=>e.field.value.keyValue&&typeof o.value=="object"?o.value[e.field.value.keyValue]:o.value),n=S(()=>e.model.value.includes(e.field.value.keyValue&&typeof o.value=="object"?o.value[e.field.value.keyValue]:o.value)),s=S(()=>{const a=e.field.value.keyValue,f=e.filteredOptions.value[e.focusOption.value];let g=!1;return f&&(g=(a&&typeof o.value=="object"?o.value[a]:o.value)==(a&&typeof f=="object"?f[a]:f)),g});se(()=>{e.allOptions.value.push({index:d.value,key:`${e.field.value.id}-option-${c}`,el:u.value})});const k=S(()=>e==null?void 0:e.allOptions.value.findIndex(a=>a.key==d.value));return fe(()=>{e==null||e.allOptions.value.splice(k.value,1)}),()=>U(o.as,{ref:u,id:`${e.field.value.id}-option-${c}`,role:"option","aria-disabled":!1,tabindex:-1,"aria-selected":n.value===!0?n.value:void 0,onKeydown:B(a=>{console.log("LComboboxOption: onKeyDown",a.key)},["stop"]),onPointerup:()=>{console.log("LComboboxOption: onPointerup")},onPointerover:()=>{console.log("LComboboxOption: onPointerover"),e.hasHover.value=!0},onPointerout:()=>{console.log("LComboboxOption: onPointerout"),e.hasHover.value=!1},onClick:B(a=>{var f;e.onChooseOption(o.value),e.onSetValue(),(f=e.field.value)!=null&&f.multiple||e.close(a,!0),e.isNone||e.onFilterOptions(!0),V(()=>{var g;(g=e.comboboxNode.value)==null||g.focus()})},["stop"])},v.default?v.default({selected:n.value,hovered:s.value}):e.field.value.keyValue&&typeof o.value=="object"?o.value[e.field.value.keyValue]:o.value)}}),Se={class:E(["outline-none flex space-x-2 items-center w-full transition"])},Be={class:"flex-auto flex flex-wrap m-1"},Ne={key:0},Ee={key:1,class:"text-s-400"},Ae={key:0,class:"flex flex-row flex-wrap"},Fe={class:"py-2 pr-2"},$e={class:"absolute right-8 top-0 h-full flex items-center"},De={class:E(["flex items-center h-6 w-6 mr-2"])},Te={key:1,class:"p-2"},Ke=A({name:"FCombobox",inheritAttrs:!1}),Pe=A({...Ke,props:{modelValue:null,error:null,field:null,required:{type:Boolean}},emits:["update:modelValue","on-input","on-load-items"],setup(o,{emit:v}){const e=o,u=S({get(){return e.modelValue},set(a){v("update:modelValue",a)}}),c=S(()=>{let a=!0;switch(typeof u.value){case"string":a=u.value=="";break;case"number":a=u.value==0;break;default:Array.isArray(u.value)&&(a=u.value.length==0);break}return a}),d=p(null),n=y(()=>{var f;const a=(f=d.value)==null?void 0:f.$el;a&&a.focus()},"onSetFocus"),s=y(async()=>{let a=0;switch(typeof u.value){case"string":a="";break;default:a=[];break}u.value=a,await v("on-input"),await n()},"onReset"),k=p(!1);return(a,f)=>{const g=ve("ripple");return O(),I(M,null,[F(a.$slots,"label",{id:o.field.id,required:o.required,onSetFocus:n}),N("div",{class:E(["flex items-center cursor-pointer",["rounded-md border text-base transition w-full appearance-none outline-none focus-within:ring-1 hover:ring-1  bg-white dark:bg-s-900",{"border-d-500 dark:border-d-500 focus-within:ring-d-500 focus-within:border-d-500 hover:ring-d-500":o.error},(k.value,""),{"border-s-200 dark:border-s-600 focus-within:ring-p-500 focus-within:border-p-500 hover:ring-p-500 hover:border-p-500":!o.error}]])},[F(a.$slots,"before"),Y(m(Ce),be(a.$attrs,{modelValue:m(u),"onUpdate:modelValue":f[0]||(f[0]=b=>me(u)?u.value=b:null),showList:k.value,"onUpdate:showList":f[1]||(f[1]=b=>k.value=b),field:o.field,error:o.error,class:"relative flex-auto",onOnLoadItems:f[2]||(f[2]=b=>a.$emit("on-load-items")),onOnInput:f[3]||(f[3]=b=>a.$emit("on-input"))}),{default:$(({combobox:b,isOpen:x,isBusy:J})=>[N("div",Se,[N("div",Be,[b.isNone.value?(O(),R(m(Le),{key:0,ref_key:"inputElement",ref:d,autocomplete:"off",class:"w-full px-2 py-1 outline-none bg-transparent"},{default:$(()=>[m(u)?(O(),I("div",Ne,D(m(u)),1)):(O(),I("div",Ee,D(o.field.placeholder),1))]),_:1},512)):(O(),I(M,{key:1},[typeof m(u)=="object"&&o.field.multiple?(O(),I("div",Ae,[(O(!0),I(M,null,oe(m(u),(T,K)=>(O(),I("div",{key:K,class:"px-2 bg-s-300 dark:bg-s-700 rounded-md mr-1 mb-1"},D(T),1))),128))])):te("",!0),Y(m(we),{ref_key:"inputElement",ref:d,autocomplete:"off",class:"w-full px-2 py-1 cursor-text outline-none bg-transparent placeholder-s-400"},null,512)],64))]),N("div",Fe,[J?(O(),R(m(Oe),{key:0})):(O(),R(m(ne),{key:1,class:E(["transition-transform",{"rotate-180":x}])},{default:$(()=>[Z(D(m(he)),1)]),_:2},1032,["class"]))]),N("div",$e,[F(a.$slots,"after",{onReset:s,empty:m(c)})])]),le(N("div",{class:E(["z-10 mt-1.5 transition overflow-hidden shadow-2xl outline-none border border-s-200 dark:border-s-700 rounded-md absolute top-full left-0 right-0 bg-white dark:bg-s-800",[x?"block":"hidden",(o.error,""),{"border-d-500 dark:border-d-500 focus-within:ring-d-500 focus-within:border-d-500":o.error},(k.value,""),{"border-s-200 dark:border-s-600 focus-within:ring-p-500 focus-within:border-p-500":!o.error}]])},[Y(m(Ve),{class:"max-h-64 b-scroll overflow-y-auto"},{default:$(({options:T,hasOptions:K})=>[K?(O(!0),I(M,{key:0},oe(T,w=>(O(),R(m(Ie),{key:o.field.keyValue?w[o.field.keyValue]:w,value:w,class:"group relative overflow-hidden"},{default:$(({selected:P,hovered:Q})=>[F(a.$slots,"option",{option:w,selected:P},()=>[le((O(),I("div",{class:E(["flex p-2 items-center cursor-pointer focus:outline-none",Q?"bg-p-200 dark:bg-p-800 text-black dark:text-white group-focus:bg-p-200 group-hover:bg-p-200 dark:group-hover:bg-p-800 dark:group-focus:bg-p-800":"bg-transparent text-black dark:text-white group-focus:bg-p-100 group-hover:bg-p-100 dark:group-hover:bg-p-900 dark:group-focus:bg-p-900"])},[N("div",De,[P?(O(),R(m(ne),{key:0,class:E(["text-xl",{"text-p-500 dark:text-p-500":P}])},{default:$(()=>[Z(D(m(ye)),1)]),_:2},1032,["class"])):te("",!0)]),Z(" "+D(o.field.keyLabel?w[o.field.keyLabel]:w),1)],2)),[[g,{}]])])]),_:2},1032,["value"]))),128)):(O(),I("div",Te,"None options"))]),_:3})],2),[[ge,x]])]),_:3},16,["modelValue","showList","field","error"])],2),F(a.$slots,"error",{error:o.error}),F(a.$slots,"description")],64)}}});Pe.__docgenInfo={exportName:"default",displayName:"FCombobox",description:"",tags:{},props:[{name:"modelValue",description:"modelValue - model string",required:!0,type:{name:"TComboboxModel"}},{name:"error",required:!1,type:{name:"string"}},{name:"field",description:"Schema for field.",required:!0,type:{name:"IField"}},{name:"required",required:!1,type:{name:"boolean"}}],events:[{name:"on-load-items"},{name:"on-input"},{name:"update:modelValue"}],slots:[{name:"label",scoped:!0,bindings:[{name:"id",title:"binding"},{name:"required",title:"binding"},{name:"onSetFocus",title:"binding"}]},{name:"before"},{name:"after",scoped:!0,bindings:[{name:"on-reset",title:"binding"},{name:"empty",title:"binding"}]},{name:"option",scoped:!0,bindings:[{name:"option",title:"binding"},{name:"selected",title:"binding"}]},{name:"error",scoped:!0,bindings:[{name:"error",title:"binding"}]},{name:"description"}]};export{Pe as _};
//# sourceMappingURL=FCombobox.0e06f52d.js.map
